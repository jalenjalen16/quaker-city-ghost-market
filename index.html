<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quaker City — Illegal Market</title>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --bg:#071027;
  --accent:#dc143c;
  --accent-2:#0047ab;
  --muted:#b0b8c0;
  --text:#ffffff;
  --glass-border: rgba(255,255,255,.04);
  --maxw:1320px;
  --kill-glow: 0 12px 44px rgba(220,20,60,0.12);
}

/* reset */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Rajdhani",sans-serif;background:transparent;color:var(--text);-webkit-font-smoothing:antialiased;padding:28px;}

/* ===== background video + overlay ===== */
.video-bg{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:0;
  filter: blur(10px) saturate(.88);
  transform: scale(1.03);
  will-change: transform, filter;
}
.video-overlay{
  position:fixed;
  inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.64));
  z-index:1;
}

/* container on top of video */
.wrap{ position:relative; z-index:6; width:100%; max-width:var(--maxw); margin:0 auto; }

/* glass panel */
.container{ background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border-radius:18px; padding:22px; border:1px solid var(--glass-border); box-shadow:0 22px 60px rgba(0,0,0,.6); backdrop-filter: blur(8px); }

/* header */
.header{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:18px; }
.header-left{ max-width:70%; }
.title{ font-size:44px; margin:0; line-height:1; font-weight:900; color:var(--accent); text-shadow:0 8px 24px rgba(0,0,0,.6); }
.subtitle{ margin-top:8px; color:var(--muted); font-weight:700; }

/* topnav */
.topnav{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; align-items:center; }
.topnav .cat{ padding:10px 14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); color:var(--muted); border:1px solid rgba(255,255,255,.03); font-weight:800; cursor:pointer; display:inline-flex; gap:8px; align-items:center; }
.topnav .cat.active{ color:var(--text); border-color: rgba(220,20,60,.28); box-shadow: var(--kill-glow); background: linear-gradient(180deg, rgba(220,20,60,.06), rgba(0,71,171,.03)); }

/* subtabs */
.subtabs{ margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.subtabs .sub{ padding:8px 12px; border-radius:999px; background: linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,0)); border:1px solid rgba(255,255,255,.03); color:var(--muted); font-weight:800; cursor:pointer; transition:all .16s ease; }
.subtabs .sub.active{ color:var(--text); background: linear-gradient(180deg, rgba(220,20,60,.12), rgba(0,71,171,.06)); box-shadow: var(--kill-glow); border-color: rgba(220,20,60,.28); transform:translateY(-2px); }

/* header right/logo */
.header-right{ display:flex; align-items:center; gap:12px; }
.logo { width:86px; height:86px; border-radius:999px; overflow:hidden; display:flex; align-items:center; justify-content:center; border:6px solid rgba(0,0,0,.35); background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.02), rgba(0,0,0,.12)); box-shadow: 0 8px 30px rgba(0,0,0,.6), 0 0 18px rgba(0,0,0,.45); }
.header-logo{ width:84%; height:84%; object-fit:cover; display:block; filter: drop-shadow(0 6px 12px rgba(0,0,0,.6)); }

/* controls */
.controls{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:16px; }
.controls .left{ display:flex; gap:10px; align-items:center; }
.choose{ color:var(--muted); font-weight:800; margin-right:6px; }
select{ background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.04); color:var(--text); padding:8px 10px; border-radius:10px; font-weight:800; }

.drop-actions{ display:flex; gap:10px; align-items:center; }
.btn{ padding:10px 14px; border-radius:10px; font-weight:900; cursor:pointer; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); color:var(--text); }
.btn.drop{ background: linear-gradient(180deg, rgba(220,20,60,.95), rgba(160,10,40,.85)); box-shadow: var(--kill-glow); color:white; }

/* music toggle */
.music-toggle{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; background:linear-gradient(180deg, rgba(0,0,0,.14), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.04); color:var(--muted); font-weight:800; cursor:pointer; }
.music-toggle.on{ color:var(--accent); box-shadow: 0 10px 30px rgba(220,20,60,.09); }

/* grid */
.grid-wrap{ margin-top:16px; border-radius:12px; padding:18px; border:1px solid rgba(255,255,255,.03); background: linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,0)); box-shadow: inset 0 6px 20px rgba(0,0,0,.3); }
.grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap:14px; align-items:stretch; }

/* cards */
.card{ border-radius:12px; padding:10px; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.04); min-height:180px; display:flex; flex-direction:column; position:relative; overflow:visible; }
.card .top-row{ display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.card .name{ font-weight:900; color:var(--muted); font-size:15px; }
.img-wrap{ flex:1 1 auto; display:flex; align-items:center; justify-content:center; padding:6px; background: linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,0)); border-radius:8px; margin-bottom:8px; }
.img-wrap img{ max-width:100%; max-height:120px; object-fit:contain; display:block; }

/* rarity badge */
.badge{ position:absolute; left:10px; bottom:10px; background:linear-gradient(180deg, rgba(0,0,0,.36), rgba(255,255,255,.02)); padding:6px 8px; border-radius:8px; font-weight:900; color:var(--muted); border:1px solid rgba(255,255,255,.03); font-size:12px; }

/* turf map */
.turf-map { width:100%; height:460px; border-radius:12px; overflow:hidden; background:linear-gradient(180deg, rgba(0,0,0,.12), rgba(255,255,255,0)); border:1px solid rgba(255,255,255,.04); box-shadow: 0 20px 60px rgba(0,0,0,.6); display:flex; align-items:center; justify-content:center; }
.turf-map img{ width:100%; height:100%; object-fit:cover; }

/* acquired list */
.acquired-heading{ margin-top:18px; font-weight:900; color:var(--accent); }
.acquired-grid{ margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; }

/* modal */
.modal-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.72); z-index:9999; }
.modal-overlay.open{ display:flex; }
.modal{ width:920px; max-width:96%; border-radius:12px; padding:18px; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); box-shadow: 0 22px 60px rgba(0,0,0,.6); }

/* responsive */
@media(max-width:980px){ .title{ font-size:34px } .grid{ grid-template-columns: repeat(auto-fill, minmax(150px,1fr)); } .img-wrap img{ max-height:90px; } .modal{ width:92% } }
@media(max-width:640px){ .title{ font-size:26px } .grid{ grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); } .img-wrap img{ max-height:76px; } }

</style>
</head>
<body>
  <!-- video background (muted, looped) -->
  <video class="video-bg" id="bgVideo" autoplay muted loop playsinline>
    <source src="background.mp4" type="video/mp4">
    <!-- fallback: user-hosted remote URL can be put here -->
  </video>
  <div class="video-overlay" aria-hidden="true"></div>

  <div class="wrap">
    <div class="header">
      <div class="header-left">
        <h1 class="title">Quaker City</h1>
        <div class="subtitle">Contraband System</div>

        <div class="topnav" id="mainNav">
          <div class="cat active" data-tab="tier1"><i class="fa-solid fa-gun"></i>&nbsp;Tier 1 Weaponry</div>
          <div class="cat" data-tab="tier2"><i class="fa-solid fa-shield"></i>&nbsp;Tier 2 Weaponry</div>
          <div class="cat" data-tab="attachments"><i class="fa-solid fa-wrench"></i>&nbsp;Attachments</div>
          <div class="cat" data-tab="drugs"><i class="fa-solid fa-capsules"></i>&nbsp;Drugs</div>
          <div class="cat" data-tab="turf"><i class="fa-solid fa-map"></i>&nbsp;Turf Map</div>
        </div>

        <div class="subtabs" id="subtabs"></div>
      </div>

      <div class="header-right">
        <div id="musicToggle" class="music-toggle" title="Toggle Music"><i class="fa-solid fa-volume-high"></i>&nbsp;<span id="musicLabel">Music: On</span></div>
        <div id="adminToggle" class="admin-flag" title="Admin"><i class="fa-solid fa-user-lock"></i></div>
        <div class="logo"><img src="Quaker.png" class="header-logo" alt="Quaker logo"></div>
      </div>
    </div>

    <div class="container">
      <div class="controls">
        <div class="left">
          <div class="choose">Filter</div>
          <select id="filterSelect">
            <option value="all">All</option>
            <option value="common">Common</option>
            <option value="uncommon">Uncommon</option>
            <option value="rare">Rare</option>
            <option value="epic">Epic</option>
            <option value="legendary">Legendary</option>
          </select>
        </div>

        <div class="drop-actions">
          <button class="btn" id="viewDropsBtn"><i class="fa-solid fa-list"></i>&nbsp;Drops</button>
          <button class="btn drop" id="dropBtn"><i class="fa-solid fa-dice"></i>&nbsp;DROP</button>
        </div>
      </div>

      <div id="contentArea">
        <div class="grid-wrap">
          <div class="grid" id="itemGrid" aria-live="polite"></div>
        </div>
      </div>

      <div class="acquired-heading">Acquired Items</div>
      <div class="acquired-grid" id="acquiredGrid"></div>

      <div style="display:flex; gap:12px; margin-top:14px; align-items:flex-start; flex-wrap:wrap;">
        <div style="flex:1; min-width:260px;">
          <div class="info-panel" id="infoPanel">Click a card to preview more info. Use DROP to open the spin modal and receive a weighted drop.</div>
        </div>
        <div style="width:320px;">
          <div class="info-panel">
            <div style="font-weight:900">Made By Route</div>
            <div style="color:var(--muted); margin-top:8px;" id="lastUpdated">Last updated: —</div>
          </div>
        </div>
      </div>
    </div>

    <div style="height:18px"></div>
    <div class="footer"><div>© Quaker City Roleplay</div><div style="color:var(--muted)">Built with ❤️</div></div>
  </div>

  <!-- Spin modal -->
  <div class="modal-overlay" id="spinModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:900; font-size:18px;">Spin Wheel</div>
        <div style="color:var(--muted); font-weight:800;">Click SPIN to start</div>
      </div>

      <div style="position:relative; margin-top:12px;">
        <div id="spinStrip" style="height:140px; display:flex; gap:12px; align-items:center; overflow:hidden; padding:10px;"></div>
        <div style="position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:6px; height:120px; border-radius:6px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); box-shadow: 0 0 24px rgba(255,200,0,.08); pointer-events:none;"></div>
      </div>

      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
        <button class="btn" id="closeSpin">Close</button>
        <button class="btn drop" id="spinStartBtn">SPIN</button>
      </div>
    </div>
  </div>

  <!-- stats modal -->
  <div class="modal-overlay" id="statsModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div id="statsTitle" style="font-weight:900;"></div>
        <button class="btn" id="closeStats"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div style="display:flex; gap:12px; margin-top:12px;">
        <div style="flex:0 0 220px; height:140px; border-radius:10px; overflow:hidden; background:rgba(0,0,0,.06); display:flex; align-items:center; justify-content:center;">
          <img id="statsImg" src="" alt="" style="max-width:100%; max-height:100%; object-fit:contain;">
        </div>
        <div style="flex:1;">
          <div id="statsRarity" style="color:var(--muted); font-weight:900;"></div>
          <div id="statsDetails" style="margin-top:12px; color:var(--muted);"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- admin panel -->
  <div class="admin-panel" id="adminPanel" aria-hidden="true">
    <h3 style="margin:6px 0 12px;">Admin Panel</h3>
    <label>Discord Webhook</label>
    <input id="adminWebhook" type="text" placeholder="https://discord.com/api/webhooks/..." style="width:100%; margin-bottom:8px;">
    <label>Server Uptime</label>
    <input id="adminUptime" type="text" placeholder="http://example.com/health" style="width:100%; margin-bottom:8px;">
    <label>Price JSON URL</label>
    <input id="adminPrices" type="text" placeholder="https://raw.githubusercontent.com/.../prices.json" style="width:100%; margin-bottom:8px;">
    <hr style="border-color:rgba(255,255,255,.03); margin:8px 0;">
    <div style="display:flex; gap:8px;">
      <button class="btn" id="saveAdminBtn">Save</button>
      <button class="btn" id="logoutAdminBtn">Logout</button>
    </div>
    <div style="color:var(--muted); margin-top:10px; font-size:13px;">Admin password (client-side): <b>Qacti</b></div>
  </div>

  <!-- audio (extracted from video) -->
  <audio id="bgm" src="background_audio.mp3" loop preload="auto"></audio>

<script>
/* Final Quaker City — video background + extracted audio; Killadelphia-style UI */

/* ---------- IMAGES mapping (put your images in /images/) ---------- */
const IMAGES = {
  '.38 Special': 'https://media.discordapp.net/attachments/1442278653823156367/1447814120631042150/832A4CE9-FD8F-4AC0-AD33-A17573FB6678.png?ex=6938fd79&is=6937abf9&hm=16aec57bccd0f7cd1175588d39da6c823d174cb0efc253dcd8a63dfd87a832ac&=&format=webp&quality=lossless&width=1409&height=1409',

  'Ghost Glock 17': 'https://media.discordapp.net/attachments/1442278653823156367/1447814120631042150/832A4CE9-FD8F-4AC0-AD33-A17573FB6678.png?ex=6938fd79&is=6937abf9&hm=16aec57bccd0f7cd1175588d39da6c823d174cb0efc253dcd8a63dfd87a832ac&=&format=webp&quality=lossless&width=1409&height=1409',

  'Glock 20 Switch': 'https://media.discordapp.net/attachments/1442278653823156367/1447814332317696166/35DA8A73-BFE3-44FB-A322-4639CCF67A20.png?ex=6938fdab&is=6937ac2b&hm=6644d393db7d29e770b205701c80883aacbd346c8535bb9eb459bf6981216e49&=&format=webp&quality=lossless&width=938&height=1407',
  'FNX -45': 'https://media.discordapp.net/attachments/1442278653823156367/1447814330769870858/343542AE-DE5C-4B32-B0D6-7423317739F8.png?ex=6938fdab&is=6937ac2b&hm=55ec25ecf1870d70cd9e7eaeab3ed41f0fe330a0f5de81d6c00a85c91077cd85&=&format=webp&quality=lossless&width=938&height=1407',
  'Beretta M9': 'https://media.discordapp.net/attachments/1442278653823156367/1447814119729401876/3528B8D0-0ECC-40C1-B78E-9F4782A78B85.png?ex=6938fd79&is=6937abf9&hm=976919ed8fe548b39448559015fdada5b779a738b3eadb74a668264972b9f15f&=&format=webp&quality=lossless&width=1174&height=1174',
  'G23': 'https://media.discordapp.net/attachments/1442278653823156367/1447814176234934442/E29B517E-6328-4E2A-92FE-FD9A53E3E99A.png?ex=6938fd86&is=6937ac06&hm=c609222cccdcd0277828ebd4f5e882fde73c5abdca1fcaa96c436de37ccb02b4&=&format=webp&quality=lossless&width=1174&height=1174',

  'Tec-9': 'data:image/png;base64,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',
  'MAC-10': 'https://media.discordapp.net/attachments/1442278653823156367/1447814331390492773/E16A3CE7-8E47-47AF-A70C-28F47AD0B33D.png?ex=6938fdab&is=6937ac2b&hm=ac47f5f2451546001cd21a8bab4738559f77a58e1bdc87f79fc153bf1e275716&=&format=webp&quality=lossless&width=938&height=1407',
  'Micro UZI': 'images/micro_uzi.png',

  'G22': 'https://media.discordapp.net/attachments/1442278653823156367/1447814249622540350/5BAD6250-1F8C-4E52-8766-BB69AB786D03.png?ex=6938fd98&is=6937ac18&hm=1ce06218616e557386fe729e05366fe621d714f977a9d34831eed564dbac33f8&=&format=webp&quality=lossless&width=938&height=1407',
  'G41': 'https://media.discordapp.net/attachments/1442278653823156367/1447814248481685504/45E3D0D9-2795-4872-BA5A-67D04AD1BDF1.png?ex=6938fd97&is=6937ac17&hm=0f0113c505728a7abb2b63968feef4259e323a13932fff1d67c2c6eb788a8855&=&format=webp&quality=lossless&width=938&height=1407',
  'G43': 'https://media.discordapp.net/attachments/1442278653823156367/1447814177744752844/D4D67B4A-0819-45AD-B9CE-9ED587FDBCFD.png?ex=6938fd87&is=6937ac07&hm=d4188a4c45f722ca271158bc7f65c51d10e222acc8ddf994585a0a8a3c4f6911&=&format=webp&quality=lossless&width=1174&height=1174',

  'MP9': 'https://media.discordapp.net/attachments/1442278653823156367/1447814119045464155/8D2F58DD-9AEC-4C7C-8D2D-47CCC9376227.png?ex=6938fd79&is=6937abf9&hm=aeebc48af0277cf9ae276786af3d2d03f53580019b21902fa971435199a67d15&=&format=webp&quality=lossless&width=1174&height=1174',
  'G19 MOS': 'https://media.discordapp.net/attachments/1442278653823156367/1447814247525646497/F3AE3066-EFE9-41CB-B578-5EC03C6A2D7A.png?ex=6938fd97&is=6937ac17&hm=b2ca9fe16355feb412525d74e3258ee78e70b5d3319f43e80658c6ab763defe7&=&format=webp&quality=lossless&width=938&height=1407',

  'AK-47': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAgCAYAAAD5VeO1AAAMRklEQVR4AQBdAKL/AJZpFf+WaRX/lmkV/5ZqFf+WahX/lmsV/5ZrFP+WbBT/lmwU/5ZtFP+WbRT/l20U/5dtFP+YbRT/mG0U/5lsFP+abBT/mmwU/5trFP+baxT/nGsU/5xqFP+cahT/AF0Aov8AlmkV/5ZpFf+WaRX/lmoV/5ZqFf+WaxX/lWsV/5ZsFP+WbBT/lm0U/5ZtFP+WbRT/l20U/5dtFP+YbRT/mWwU/5lsFP+abBT/m2sU/5trFP+caxT/nGoU/5xqFP8AXQCi/wCVaRb/lWkW/5VpFv+VahX/lWoV/5VrFf+VaxX/lWwV/5VsFf+VbRX/lW0U/5ZtFP+WbRT/l20U/5dtFP+YbRT/mWwU/5lsFP+aaxX/m2sV/5trFf+baxX/m2oV/wBdAKL/AJVpFv+UaRb/lGoW/5RqFv+Uahb/lGsW/5RrFv+UbBb/lGwV/5RtFf+VbRX/lW0V/5ZtFf+WbRX/l20V/5dtFf+YbBX/mWwV/5lsFf+aaxX/mmsV/5trFf+baxX/AF0Aov8Ak2kX/5NpF/+Tahf/k2oX/5NrF/+Taxf/k2wW/5NsFv+TbRb/k20W/5RtFv+UbRb/lG0W/5VtFv+WbRb/lm0W/5dtFv+YbBb/mGwW/5lrFv+Zaxb/mmsW/5prFv8AXQCi/wCSaRj/kmoY/5JqGP+Sahj/kmsY/5JrGP+SbBf/kmwX/5JtF/+SbRf/km0X/5NuF/+Tbhf/lG4X/5RtF/+VbRf/lm0X/5ZsF/+XbBf/mGwX/5hrF/+Yaxf/mGsX/wBdAKL/AJFqGf+Rahn/kWoZ/5FqGf+Raxn/kWsZ/5BsGP+RbRj/kW0Y/5FtGP+Rbhj/kW4Y/5JuGP+Sbhj/k24Y/5RtGP+UbRj/lW0Y/5ZsGP+WbBj/l2wY/5dsGP+Xaxj/AF0Aov8Aj2oa/49qGv+Pahr/j2sa/49rGv+PbBr/j2wZ/49tGf+PbRn/j24Z/5BuGf+Qbhn/kW4Z/5FuGf+Sbhn/km4Z/5NtGf+UbRn/lG0Z/5VsGf+VbBn/lmwZ/5ZsGf8AXQCi/wCOahv/jmob/45qG/+Oaxv/jmsb/45sG/+ObBv/jm0a/45tGv+Obhr/jm4a/49uGv+Pbhr/kG4a/5BuGv+Rbhr/km4a/5JtGv+TbRr/k20a/5RsGv+UbBr/lGwa/wBdAKL/AIxqHP+Mahz/jGsc/4xrHP+Maxz/jGwc/4xtHP+MbRv/jG4b/4xuG/+Nbhv/jW8b/45vG/+Obxv/j28b/5BuG/+Qbhv/kW4b/5JtG/+SbRv/km0b/5NsG/+TbBv/AF0Aov8Ai2od/4tqHf+Lax3/i2sd/4tsHf+LbB3/i20d/4ttHP+Lbhz/i24c/4tvHP+Mbxz/jG8c/41vHP+Obxz/jm8c/49uHP+Qbhz/kG4c/5FtHP+RbRz/kW0c/5JtHP8AXQCi/wCKah7/imse/4prHv+Kax7/imwe/4psHv+JbR3/im0d/4puHf+Kbh3/im8d/4tvHf+Lbx3/jG8d/4xvHf+Nbx3/jm4d/45uHf+Pbh3/kG4d/5BtHf+QbR3/kG0d/wBdAKL/AIlqH/+Jax//iWsf/4lrH/+IbB7/iGwe/4htHv+Ibh7/iW4e/4lvHv+Jbx7/im8e/4pvHv+Lbx7/i28e/4xvHv+Nbx7/jW4e/45uHv+Pbh7/j20e/49tHv+PbR7/AF0Aov8AiGof/4hrH/+Iax//iGsf/4hsH/+IbB//iG0f/4huH/+Ibh7/iG8e/4hvHv+Jbx7/iW8e/4pvHv+Kbx7/i28e/4xvHv+Nbx7/jW4e/45uHv+Obh//j20f/49tH/8AXQCi/wCHaiD/h2sg/4drIP+Hax//h2wf/4dsH/+HbR//h24f/4duH/+Hbx//iG8f/4hvH/+Jbx//iW8f/4pvH/+Lbx//i28f/4xvH/+Nbh//jW4f/45uH/+Obh//jm4f/wBdAKL/AIdqIP+HaiD/h2sg/4drIP+HbCD/h2wf/4dtH/+Hbh//h24f/4dvH/+Hbx//iG8f/4hvH/+JcB//im8f/4pvH/+Lbx//jG8f/4xuH/+Nbh//jW4f/45uH/+Obh//AF0Aov8Ah2og/4dqIP+HayD/h2sg/4dsH/+HbB//h20f/4dtH/+Hbh//h28f/4dvH/+Ibx//iG8f/4lvH/+Kbx//im8f/4tvH/+Mbx//jG4f/41uH/+Nbh//jm4f/45uH/8AXQCi/wCHah//h2of/4dqH/+Hax//h2sf/4dsH/+HbR//h20f/4duH/+Hbh7/iG8e/4hvHv+Jbx7/iW8e/4pvHv+Lbx7/i28e/4xvHv+Nbh//jW4f/45uH/+Obh//jm4f/wBdAKL/AIhqH/+Iah//iGof/4drH/+Hax//h2we/4dsHv+IbR7/iG4e/4huHv+Ibx7/iW8e/4lvHv+Kbx7/i28e/4tvHv+Mbx7/jW8e/41uHv+Obh7/jm4e/49uHv+Pbh7/AF0Aov8AiGke/4hpHv+Iah7/iGoe/4hrHv+Iax7/iGwe/4htHf+IbR3/iW4d/4luHf+Jbx3/im8d/4tvHf+Lbx3/jG8d/41vHf+Obh3/jm4d/49uHf+Pbh3/kG4d/5BtHv8AXQCi/wCJaR3/iWkd/4lpHf+Jah3/iWod/4lrHf+JbB3/iWwc/4ltHP+Kbhz/im4c/4tuHP+Lbxz/jG8c/4xvHP+Nbxz/jm8c/49uHP+Pbhz/kG4c/5BuHf+RbR3/kW0d/wBdAKL/AItpHP+LaRz/imkc/4ppHP+Kahz/imsc/4prHP+KbBv/i20b/4ttG/+Lbhv/jG4b/4xuG/+Nbxv/jm8b/45uG/+Pbhv/kG4b/5FuG/+Rbhv/km0c/5JtHP+SbRz/AF0Aov8AjGgb/4xoG/+MaRv/jGkb/4xqG/+Mahv/jGsa/4xsGv+MbBr/jG0a/41tGv+Nbhr/jm4a/45uGv+Pbhr/kG4a/5BuGv+Rbhr/km4a/5JtGv+TbRr/k20a/5NtGv8AXQCi/wCNaBr/jWga/41oGv+NaRr/jWkZ/41qGf+Naxn/jWsZ/41sGf+ObRn/jm0Z/45uGf+Pbhn/kG4Z/5BuGf+Rbhn/km4Z/5NtGf+TbRn/lG0Z/5RtGf+VbRn/lW0Z/wBdAKL/AI9nGP+PZxj/j2gY/49oGP+PaRj/jmoY/49qGP+Paxj/j2wY/49sGP+PbRj/kG0X/5FtF/+Rbhf/km4X/5NuGP+TbRj/lG0Y/5VtGP+VbRj/lm0Y/5ZsGP+WbBj/AF0Aov8AkGcX/5BnF/+QZxf/kGgX/5BoF/+QaRf/kGoX/5BrF/+Qaxb/kWwW/5FsFv+RbRb/km0W/5NtFv+TbRb/lG0W/5VtFv+WbRf/lm0X/5dsF/+XbBf/mGwX/5hsF/8AXQCi/wCRZxb/kWcW/5FnFv+RaBb/kWgW/5FpFv+Rahb/kWoV/5JrFf+SbBX/kmwV/5NtFf+TbRX/lG0V/5VtFf+VbRX/lm0V/5dtFf+YbBX/mGwW/5lsFv+ZbBb/mWwW/wBdAKL/AJNmFf+TZhX/kmcV/5JnFf+SaBX/kmkV/5JpFf+TahT/k2sU/5NrFP+TbBT/lGwU/5RtFP+VbRT/lm0U/5dtFP+XbRT/mGwU/5lsFP+ZbBX/mmwV/5psFf+abBX/AF0Aov8AlGYU/5RmFP+UZhT/k2cU/5NoFP+TaBT/k2kU/5RqFP+UahP/lGsT/5RsE/+VbBP/lmwT/5ZtE/+XbRP/mG0T/5hsE/+ZbBT/mmwU/5psFP+bbBT/m2sU/5trFP8AXQCi/wCUZhT/lGYU/5RmE/+UZxP/lGcT/5RoE/+UaRP/lGoT/5VqE/+VaxP/lWsT/5ZsE/+WbBP/l2wT/5hsE/+YbBP/mWwT/5psE/+bbBP/m2wT/5xrE/+caxP/nGsT/wBdAKL/AJVmE/+VZhP/lWYT/5VnE/+VZxP/lWgT/5VpE/+VaRL/lWoS/5VrEv+WaxL/lmwS/5dsEv+YbBL/mGwS/5lsEv+abBL/m2wS/5tsE/+cbBP/nGsT/51rE/+daxP/AV0Aov8AlWYT/5VmE/+VZhP/lWcT/5VnE/+VaBL/lWkS/5VpEv+VahL/lmsS/5ZrEv+XbBL/l2wS/5hsEv+ZbBL/mWwS/5psEv+bbBL/nGwS/5xrEv+daxL/nWsS/51rEv/ZxfwA+rjcTgAAAABJRU5ErkJggg==',
  'HELLPUP DRACO': 'https://media.discordapp.net/attachments/1442278653823156367/1447814499363983380/F0D2E6C6-183F-4CC9-904C-9F87B960B06C.png?ex=6938fdd3&is=6937ac53&hm=c40b2fff419247c3224f930075728d431f1626c69d13192a3dab2e7b41b09801&=&format=webp&quality=lossless&width=938&height=1407',
  'Black ARP': 'https://media.discordapp.net/attachments/1442278653823156367/1447814373601972285/C4FE017E-B958-42C2-9C74-6268A11CD25A.png?ex=6938fdb5&is=6937ac35&hm=ad76540e38b64398d91474fbb80cd023862a4a3e42c420b93c19f71fa499830a&=&format=webp&quality=lossless&width=938&height=1407',
  'KEL-TEC PLR': 'https://media.discordapp.net/attachments/1442278653823156367/1447814331868774410/37DC7D8A-3EA6-4F01-9436-D5E736E13C4A.png?ex=6938fdab&is=6937ac2b&hm=c233af0b74069b5196ee10448b44ec96c8a10322285015ab58daf74bc9603bcd&=&format=webp&quality=lossless&width=938&height=1407'
};

const FALLBACK = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="240"%3E%3Crect fill="%23333" width="400" height="240"/%3E%3Ctext x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E';

/* weapon stats (modal only) */
const WEAPON_STATS = {
  '.38 Special': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 33 },                  // Common
  'Ghost Glock 17': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 33 },               // Common
  'Glock 20 Switch': { damage: 35, fire: 600, ammo: '.45 ACP', magStd: 10, magExt: 21 },          // Epic
  'FNX -45': { damage: 35, fire: 750, ammo: '9mm', magStd: 15, magExt: 30 },                      // Epic
  'Beretta M9': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 30 },                   // Common
  'G23': { damage: 25, fire: 750, ammo: '9mm', magStd: 16, magExt: 32 },                          // Uncommon
  'Tec-9': { damage: 35, fire: 400, ammo: '.45 ACP', magStd: 8, magExt: 16 },                     // Epic
  'MAC-10': { damage: 35, fire: 1000, ammo: '9mm', magStd: 20, magExt: 40 },                      // Epic
  'Micro UZI': { damage: 35, fire: 1090, ammo: '.45 ACP', magStd: 30, magExt: 50 },               // Epic
  'G22': { damage: 30, fire: 1200, ammo: '9mm', magStd: 25, magExt: 50 },                         // Rare
  'G41': { damage: 30, fire: 1100, ammo: '.32 ACP', magStd: 20, magExt: 40 },                     // Rare
  'G43': { damage: 25, fire: 800, ammo: '9mm', magStd: 30, magExt: 60 },                          // Uncommon
  'MP9': { damage: 25, fire: 600, ammo: '.45 ACP', magStd: 25, magExt: 50 },                      // Common
  'G19 MOS': { damage: 30, fire: 900, ammo: '5.7x28', magStd: 50, magExt: 100 },                  // Rare
  'AK-47': { damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },                    // Legendary
  'HELLPUP DRACO': { damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },            // Legendary
  'Black ARP': { damage: 35, fire: 800, ammo: '5.56x45', magStd: 30, magExt: 60 },                // Epic
  'KEL-TEC PLR': { damage: 35, fire: 1200, ammo: '.45 ACP', magStd: 25, magExt: 50 },             // Epic
  'HELLPUP Draco': { damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 }             // Legendary
};


/* items */
const ITEMS = {
  tier1: [
    { name:'Ghost Glock 17', rarity:'common', category:'Pistols', img:IMAGES['Ghost Glock 17'] || FALLBACK },
    { name:'MP9', rarity:'common', category:'Pistols', img:IMAGES['MP9'] || FALLBACK },
    { name:'Glock 20 Switch', rarity:'epic', category:'Pistols', img:IMAGES['Glock 20 Switch'] || FALLBACK },
    { name:'Beretta M9', rarity:'uncommon', category:'Pistols', img:IMAGES['Beretta M9'] || FALLBACK },
    { name:'MAC-10', rarity:'rare', category:'SMG', img:IMAGES['MAC-10'] || FALLBACK },
    { name:'G22', rarity:'rare', category:'SMG', img:IMAGES['G22'] || FALLBACK },
    { name:'G41', rarity:'rare', category:'SMG', img:IMAGES['G41'] || FALLBACK },
    { name:'Micro UZI', rarity:'rare', category:'SMG', img:IMAGES['Micro UZI'] || FALLBACK },
    { name:'G19 MOS', rarity:'rare', category:'SMG', img:IMAGES['G19 MOS'] || FALLBACK },
    { name:'P90', rarity:'epic', category:'SMG', img:IMAGES['P90'] || FALLBACK },
    { name:'FNX-45', rarity:'epic', category:'Pistols', img:FALLBACK }
  ],
  tier2: [
    { name:'AK-47', rarity:'legendary', category:'ARs', img:IMAGES['AK-47'] || FALLBACK },
    { name:'Black ARP', rarity:'epic', category:'ARs', img:IMAGES['Black ARP'] || FALLBACK },
    { name:'KEL-TEC PLR', rarity:'epic', category:'ARs', img:IMAGES['KEL-TEC PLR'] || FALLBACK },
    { name:'HELLPUP DRACO', rarity:'legendary', category:'ARs', img:IMAGES['HELLPUP DRACO'] || FALLBACK }
  ],
  attachments: [
    { name:'Extended Magazine', rarity:'rare', category:'Mags', img:FALLBACK },
    { name:'Flashlight', rarity:'uncommon', category:'Mags', img:FALLBACK }
  ],
  drugs: [
    { name:'RP 10', rarity:'common', category:'Common', img:FALLBACK },
    { name:'RP 20', rarity:'rare', category:'Rare', img:FALLBACK }
  ]
};

const DEFAULT_WEIGHTS = {
  tier1: { common:40, uncommon:45, rare:15, epic:10 },
  tier2: { rare:50, epic:40, legendary:10 },
  attachments: { uncommon:50, rare:30, epic:15, legendary:5 },
  drugs: { common:35, uncommon:25, rare:25, epic:15 }
};

/* refs (mutables) */
let itemGrid = document.getElementById('itemGrid');
const contentArea = document.getElementById('contentArea');
const subtabsEl = document.getElementById('subtabs');
const filterSelect = document.getElementById('filterSelect');
const dropBtn = document.getElementById('dropBtn');
const viewDropsBtn = document.getElementById('viewDropsBtn');
const acquiredGrid = document.getElementById('acquiredGrid');
const spinModal = document.getElementById('spinModal');
const spinStrip = document.getElementById('spinStrip');
const spinStartBtn = document.getElementById('spinStartBtn');
const closeSpin = document.getElementById('closeSpin');
const musicToggle = document.getElementById('musicToggle');
const musicLabel = document.getElementById('musicLabel');
const bgm = document.getElementById('bgm');

const adminToggle = document.getElementById('adminToggle');
const adminPanel = document.getElementById('adminPanel');
const saveAdminBtn = document.getElementById('saveAdminBtn');
const logoutAdminBtn = document.getElementById('logoutAdminBtn');
const adminWebhook = document.getElementById('adminWebhook');
const adminUptime = document.getElementById('adminUptime');
const adminPrices = document.getElementById('adminPrices');

const statsModal = document.getElementById('statsModal');
const statsTitle = document.getElementById('statsTitle');
const statsImg = document.getElementById('statsImg');
const statsRarity = document.getElementById('statsRarity');
const statsDetails = document.getElementById('statsDetails');
const closeStats = document.getElementById('closeStats');

let activeTab = 'tier1';
let activeSub = 'All';
let acquired = [];
let spinning = false;

/* helpers */
function tick(ms){ return new Promise(r=> setTimeout(r,ms)); }
function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function loadCfg(){ try{return JSON.parse(localStorage.getItem('qc_cfg')||'{}')}catch(e){return{}} }
function saveCfg(c){ localStorage.setItem('qc_cfg', JSON.stringify(c)); }
function getWeights(){ const c = loadCfg(); return c.weights || DEFAULT_WEIGHTS; }
function setWeights(w){ const c = loadCfg(); c.weights = w; saveCfg(c); }

/* admin */
const ADMIN_PASS = 'Qacti';
function isAdmin(){ return sessionStorage.getItem('qc_admin') === '1'; }
function setAdmin(flag){ if(flag) sessionStorage.setItem('qc_admin','1'); else sessionStorage.removeItem('qc_admin'); adminPanel.style.display = flag ? 'block':'none'; }
adminToggle.addEventListener('click', ()=>{
  if(isAdmin()){ adminPanel.style.display = adminPanel.style.display === 'block' ? 'none':'block'; return; }
  const p = prompt('Enter admin password:'); if(p === ADMIN_PASS){ setAdmin(true); loadAdmin(); alert('Admin ON'); } else alert('Wrong password');
});
logoutAdminBtn.addEventListener('click', ()=> { setAdmin(false); adminPanel.style.display = 'none'; alert('Logged out'); });
saveAdminBtn.addEventListener('click', ()=> {
  if(!isAdmin()){ alert('Admin only'); return; }
  const cfg = loadCfg(); cfg.webhook = adminWebhook.value.trim(); cfg.uptime = adminUptime.value.trim(); cfg.prices = adminPrices.value.trim(); saveCfg(cfg); alert('Saved');
});
function loadAdmin(){ const cfg = loadCfg(); adminWebhook.value = cfg.webhook||''; adminUptime.value = cfg.uptime||''; adminPrices.value = cfg.prices||''; }

/* subtabs */
const SUBTABS = {
  tier1: ['All','Pistols','SMG','ARs','Specials'],
  tier2: ['All','ARs','Snipers','LMGs'],
  attachments: ['All','Mags','Optics','Other'],
  drugs: ['All','Common','Rare']
};
function renderSubtabs(tab){
  subtabsEl.innerHTML = '';
  const arr = SUBTABS[tab] || ['All'];
  arr.forEach((s,i)=>{
    const el = document.createElement('div');
    el.className = 'sub' + (i===0 ? ' active' : '');
    el.textContent = s;
    el.dataset.sub = s;
    el.addEventListener('click', ()=> {
      document.querySelectorAll('.subtabs .sub').forEach(x=> x.classList.remove('active'));
      el.classList.add('active');
      activeSub = s;
      renderGrid();
    });
    subtabsEl.appendChild(el);
  });
  activeSub = arr[0];
}

/* filtering */
function itemsForTab(tab){
  const all = (ITEMS[tab] || []).slice();
  const filter = filterSelect.value;
  let res = all;
  if(filter !== 'all') res = res.filter(i => i.rarity === filter);
  if(activeSub && activeSub !== 'All'){
    res = res.filter(i=>{
      const cat = (i.category||'').toLowerCase();
      const s = activeSub.toLowerCase();
      if(s === 'smg') return cat.includes('smg');
      if(s === 'pistols') return cat.includes('pist');
      return cat.includes(s);
    });
  }
  return res;
}

/* create card (clean, no stats) */
function createCard(item){
  const el = document.createElement('div');
  el.className = 'card';
  el.innerHTML = `
    <div class="top-row"><div class="name">${item.name}</div></div>
    <div class="img-wrap"><img loading="lazy" src="${item.img}" alt="${item.name}" onerror="this.src='${FALLBACK}'"></div>
    <div style="height:8px"></div>
    <div class="badge">${(item.rarity||'common').toUpperCase()}</div>
  `;
  el.addEventListener('click', ()=> openCardDetails(item));
  return el;
}

/* render grid (handles turf tab) */
function renderGrid(){
  const nodes = itemsForTab(activeTab);
  if(activeTab === 'turf'){
    const local = 'images/turfmap.png';
    const remote = 'https://media.discordapp.net/attachments/1445307831220699229/1447757901463683114/image.png';
    contentArea.innerHTML = `<div class="turf-map"><img src="${local}" alt="Turf Map" onerror="this.onerror=null; this.src='${remote}';"></div>`;
    return;
  }

  contentArea.innerHTML = `<div class="grid-wrap"><div class="grid" id="itemGrid" aria-live="polite"></div></div>`;
  itemGrid = document.getElementById('itemGrid');
  itemGrid.innerHTML = '';
  if(nodes.length === 0){
    itemGrid.innerHTML = '<div style="grid-column:1/-1; color:var(--muted); padding:18px; text-align:center;">No items in this category.</div>';
    return;
  }
  nodes.forEach(it => itemGrid.appendChild(createCard(it)));
}

/* card details modal */
function openCardDetails(item){
  statsTitle.textContent = item.name;
  statsRarity.textContent = (item.rarity||'common').toUpperCase();
  statsImg.src = item.img || FALLBACK;
  const s = WEAPON_STATS[item.name] || {};
  statsDetails.innerHTML = `
    <div style="font-weight:900">${item.name}</div>
    <div style="color:var(--muted); margin-top:8px;">
      Damage: ${s.damage ?? '-'}<br>
      Fire Rate: ${s.fire ? s.fire + ' RPM' : '-'}<br>
      Ammo: ${s.ammo ?? '-'}<br>
      Magazine: ${s.magStd ?? '-'} (Ext ${s.magExt ?? '-'})
    </div>
  `;
  statsModal.classList.add('open'); statsModal.style.display = 'flex';
}
closeStats.addEventListener('click', ()=> { statsModal.classList.remove('open'); statsModal.style.display = 'none'; });
document.getElementById('statsModal').addEventListener('click', (e)=> { if(e.target.id === 'statsModal'){ statsModal.classList.remove('open'); statsModal.style.display = 'none'; } });

/* topnav click (robust) */
document.querySelectorAll('.topnav .cat').forEach(el=>{
  el.addEventListener('click', ()=> {
    document.querySelectorAll('.topnav .cat').forEach(x=> x.classList.remove('active'));
    el.classList.add('active');
    activeTab = el.dataset.tab;
    renderSubtabs(activeTab);
    renderGrid();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
});

/* filter */
filterSelect.addEventListener('change', ()=> renderGrid());

/* music toggle logic */
function setMusicOn(on){
  localStorage.setItem('qc_music_on', on ? '1':'0');
  if(on){ musicToggle.classList.add('on'); musicLabel.textContent = 'Music: On'; musicToggle.querySelector('i').className='fa-solid fa-volume-high'; bgm.play().catch(()=>{}); }
  else { musicToggle.classList.remove('on'); musicLabel.textContent = 'Music: Off'; musicToggle.querySelector('i').className='fa-solid fa-volume-xmark'; bgm.pause(); }
}
musicToggle.addEventListener('click', ()=> {
  const current = localStorage.getItem('qc_music_on') === '1';
  setMusicOn(!current);
});
function enableBGM(){ function start(){ if(bgm){ bgm.play().catch(()=>{}); } document.removeEventListener('click', start); document.removeEventListener('touchstart', start); } document.addEventListener('click', start); document.addEventListener('touchstart', start); }
enableBGM();
setTimeout(()=> { const mp = localStorage.getItem('qc_music_on'); setMusicOn(mp !== '0'); }, 100);

/* spinner modal */
function renderSpinStrip(){
  spinStrip.innerHTML = '';
  const pool = (ITEMS[activeTab]||[]).slice();
  if(pool.length === 0){ spinStrip.innerHTML = '<div style="color:var(--muted)">No items in this category.</div>'; return; }
  for(let i=0;i<40;i++){
    const it = rand(pool);
    const tile = document.createElement('div');
    tile.style.minWidth='140px'; tile.style.height='120px'; tile.style.borderRadius='10px'; tile.style.overflow='hidden';
    tile.style.background='linear-gradient(180deg, rgba(0,0,0,.16), rgba(255,255,255,0))'; tile.style.border='1px solid rgba(255,255,255,.04)';
    tile.style.display='flex'; tile.style.flexDirection='column'; tile.style.alignItems='center'; tile.style.justifyContent='center';
    tile.style.padding='8px'; tile.innerHTML = `<div style="font-weight:900;color:var(--muted);margin-bottom:6px;">${it.name}</div><img src="${it.img}" style="max-width:100%; max-height:64px; object-fit:contain" onerror="this.src='${FALLBACK}'">`;
    spinStrip.appendChild(tile);
  }
}
function openSpinModal(){ spinModal.classList.add('open'); spinModal.style.display='flex'; renderSpinStrip(); }
function closeSpinModal(){ spinModal.classList.remove('open'); spinModal.style.display='none'; }
dropBtn.addEventListener('click', openSpinModal);
closeSpin.addEventListener('click', closeSpinModal);

function pickRarity(weights){
  const entries = Object.entries(weights).filter(([k,v])=> Number(v) > 0);
  const total = entries.reduce((s,[_k,v])=> s + Number(v), 0);
  const r = Math.random() * total; let acc = 0;
  for(const [k,v] of entries){ acc += Number(v); if(r <= acc) return k; }
  return entries[entries.length-1][0];
}
function pickWeightedItem(tabKey){
  const w = getWeights();
  const weights = w[tabKey] || DEFAULT_WEIGHTS[tabKey] || DEFAULT_WEIGHTS.tier1;
  const rarity = pickRarity(weights);
  const pool = (ITEMS[tabKey]||[]).filter(i=> i.rarity === rarity);
  if(pool.length) return rand(pool);
  const all = [].concat(...Object.values(ITEMS));
  return rand(all);
}
spinStartBtn.addEventListener('click', async ()=>{
  if(spinning) return;
  spinning = true;
  playSFX('spin');
  const shifts = 48 + Math.floor(Math.random()*46);
  for(let i=0;i<shifts;i++){
    if(spinStrip.firstElementChild) spinStrip.appendChild(spinStrip.firstElementChild);
    const progress = i/shifts;
    const delay = 18 + Math.pow(progress,2)*520;
    await tick(delay);
  }
  const picked = pickWeightedItem(activeTab);
  addAcquired(picked);
  sendWebhook({ action:'spin', tier:activeTab, result:picked.name, rarity:picked.rarity, ts:new Date().toISOString() });
  playSFX('win');
  setTimeout(()=> { closeSpinModal(); spinning = false; }, 1200);
});

/* acquired */
function addAcquired(item){
  acquired.unshift(item);
  const card = document.createElement('div');
  card.className = 'drop-card';
  card.style.display='flex'; card.style.gap='10px'; card.style.alignItems='center'; card.style.padding='8px'; card.style.borderRadius='10px';
  card.style.border='1px solid rgba(255,255,255,.04)'; card.style.background='linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,0))';
  card.innerHTML = `<img src="${item.img}" style="width:56px;height:56px;object-fit:contain;border-radius:8px;" onerror="this.src='${FALLBACK}'"><div><div style="font-weight:900">${item.name}</div><div style="color:var(--muted);font-size:12px">${(item.rarity||'common').toUpperCase()}</div></div>`;
  card.addEventListener('click', ()=> openCardDetails(item));
  acquiredGrid.prepend(card);
  while(acquiredGrid.children.length > 120) acquiredGrid.removeChild(acquiredGrid.lastChild);
}

/* SFX */
const audioCtx = (window.AudioContext || window.webkitAudioContext) ? new (window.AudioContext||window.webkitAudioContext)() : null;
function playTone(freq,len=0.08,type='sine',gain=0.06){
  if(!audioCtx) return;
  try{ const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type=type; o.frequency.value=freq; o.connect(g); g.connect(audioCtx.destination); const now = audioCtx.currentTime; g.gain.value=0; g.gain.linearRampToValueAtTime(gain, now+0.01); o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+len); o.stop(now+len+0.02); }catch(e){}
}
function playSFX(name){
  if(!audioCtx) return;
  if(audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
  if(name === 'click') playTone(880,0.06,'square',0.05);
  if(name === 'spin') playTone(240,0.12,'sawtooth',0.12);
  if(name === 'win'){ playTone(880,0.08,'sine',0.12); setTimeout(()=>playTone(1320,0.12,'sine',0.11),120); setTimeout(()=>playTone(1760,0.16,'sine',0.09),260); }
}

/* webhooks */
function sendWebhook(payload){
  const cfg = loadCfg();
  const webhook = cfg.webhook || '';
  if(!webhook) return;
  fetch(webhook, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ content: `Quaker | ${payload.action} → ${payload.result||''} (${payload.rarity||''}) — ${payload.ts||''}` }) })
    .catch(e=> console.warn('webhook fail', e));
}

/* startup */
function init(){
  renderSubtabs(activeTab);
  renderGrid();
  const cfg = loadCfg();
  if(cfg.webhook) adminWebhook.value = cfg.webhook;
  if(cfg.uptime) adminUptime.value = cfg.uptime;
  if(cfg.prices) adminPrices.value = cfg.prices;
  document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleString();
  // music pref
  const mp = localStorage.getItem('qc_music_on');
  setTimeout(()=> setMusicOn(mp !== '0'), 60);
  // enable audio context resume
  document.addEventListener('click', ()=> { if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{}); });
  console.log('Quaker City final (video bg + audio) ready. Admin password (client-side):', ADMIN_PASS);
}
init();

/* ESC close modals */
document.addEventListener('keydown', (e)=> { if(e.key === 'Escape'){ document.querySelectorAll('.modal-overlay.open').forEach(m=>{ m.classList.remove('open'); m.style.display='none'; }); } });
/* backdrop close */
document.querySelectorAll('.modal-overlay').forEach(m=> m.addEventListener('click', (e)=> { if(e.target === m){ m.classList.remove('open'); m.style.display='none'; } }));

</script>
</body>
</html>
