<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quaker City — Contraband System</title>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --bg:#071027;
  --accent:#dc143c;
  --accent-2:#0047ab;
  --muted:#b0b8c0;
  --text:#ffffff;
  --glass-border: rgba(255,255,255,.04);
  --maxw:1320px;
  --kill-glow: 0 12px 44px rgba(220,20,60,0.12);
}

/* base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Rajdhani",sans-serif;background:transparent;color:var(--text);}

/* -------------- Background Video -------------- */
#bgVideo {
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  filter: blur(10px) brightness(0.45) saturate(0.8);
  z-index:0;
}
#bgDark {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.60);
  z-index:1;
}
#bgEmblem {
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  width:60vw;
  max-width:900px;
  opacity:0.08;
  z-index:1;
  pointer-events:none;
  filter: blur(2px);
}

/* -------------- Neon Red SELECTOR -------------- */
.neon-pointer {
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:8px;
  height:120px;
  border-radius:6px;
  background:rgba(255,0,0,0.85);
  box-shadow:
    0 0 20px rgba(255,0,0,0.7),
    0 0 40px rgba(255,0,0,0.5),
    0 0 80px rgba(255,0,0,0.4);
  z-index:20;
  pointer-events:none;
}

/* -------------- YOU GOT POPUP -------------- */
.you-got-popup {
  position:fixed;
  top:0; left:0;
  width:100vw; height:100vh;
  background:rgba(0,0,0,0.65);
  backdrop-filter:blur(8px);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:99999;
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease-out;
}

.you-got-popup.active {
  opacity:1;
  pointer-events:auto;
}

.you-got-box {
  width: 82%;
  max-width: 920px;
  padding: 25px;
  border-radius:14px;
  background:linear-gradient(180deg, rgba(25,0,0,0.9), rgba(10,0,0,0.85));
  border:1px solid rgba(255,0,0,0.25);
  box-shadow:
    0 0 20px rgba(255,0,0,0.4),
    0 0 60px rgba(255,0,0,0.25);
  animation: popupEnter 0.45s ease-out forwards;
}

/* Scale + Fade In */
@keyframes popupEnter {
  from {
    transform:scale(0.65);
    opacity:0;
  }
  to {
    transform:scale(1);
    opacity:1;
  }
}

/* ---- Shockwave Burst ---- */
.you-got-shockwave {
  position:absolute;
  width:180px;
  height:180px;
  border-radius:999px;
  border:4px solid rgba(255,0,0,0.65);
  left:50%; top:50%;
  transform:translate(-50%,-50%) scale(0.1);
  opacity:0.9;
  pointer-events:none;
  animation: shockwave 1s ease-out forwards;
}

@keyframes shockwave {
  0% {
    transform:translate(-50%,-50%) scale(0.1);
    opacity:1;
    border-color:rgba(255,0,0,0.9);
  }
  70% {
    opacity:0.8;
  }
  100% {
    transform:translate(-50%,-50%) scale(2.8);
    opacity:0;
    border-color:rgba(255,0,0,0);
  }
}

.you-got-title {
  font-size:36px;
  font-weight:900;
  color:var(--accent);
  text-align:center;
  margin-bottom:12px;
  text-shadow:0 0 18px rgba(255,0,0,0.45);
}

.you-got-body {
  display:flex;
  gap:20px;
  align-items:center;
  justify-content:center;
}

.you-got-img {
  width:280px;
  height:280px;
  object-fit:contain;
  filter:drop-shadow(0 0 20px rgba(255,0,0,0.4));
}

.you-got-info {
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:flex-start;
}

.you-got-name {
  font-size:30px;
  font-weight:900;
}

.you-got-rarity {
  padding:6px 12px;
  border-radius:999px;
  font-weight:900;
  font-size:14px;
  background:rgba(255,255,255,0.1);
  text-transform:uppercase;
}

.you-got-close {
  margin-top:18px;
  padding:10px 16px;
  border-radius:12px;
  font-weight:900;
  cursor:pointer;
  background:rgba(255,0,0,0.7);
  color:white;
  border:1px solid rgba(255,0,0,0.35);
  transition:0.15s;
}
.you-got-close:hover {
  background:rgba(255,0,0,0.95);
  box-shadow:0 0 18px rgba(255,0,0,0.4);
}

</style>
</head>
<body>

<!-- Background video (muted) -->
<video id="bgVideo" autoplay muted loop playsinline>
  <source src="Video.mp4" type="video/mp4">
</video>
<div id="bgDark" aria-hidden="true"></div>
<img id="bgEmblem" src="Quaker.png" alt="" aria-hidden="true">

<div class="wrap">
  <div class="header">
    <div class="header-left">
      <h1 class="title">Quaker City</h1>
      <div class="subtitle">Contraband System</div>

      <div class="topnav" id="mainNav">
        <div class="cat active" data-tab="tier1"><i class="fa-solid fa-gun"></i>&nbsp;Tier 1 Weaponry</div>
        <div class="cat" data-tab="tier2"><i class="fa-solid fa-shield"></i>&nbsp;Tier 2 Weaponry</div>
        <div class="cat" data-tab="attachments"><i class="fa-solid fa-wrench"></i>&nbsp;Attachments</div>
        <div class="cat" data-tab="drugs"><i class="fa-solid fa-capsules"></i>&nbsp;Drugs</div>
        <div class="cat" data-tab="turf"><i class="fa-solid fa-map"></i>&nbsp;Turf Map</div>
      </div>

      <div class="subtabs" id="subtabs"></div>
    </div>

    <div class="header-right">
      <div id="musicToggle" class="music-toggle" title="Toggle Music">
        <i class="fa-solid fa-volume-high"></i>&nbsp;<span id="musicLabel">Music: On</span>
      </div>

      <div id="adminToggle" class="admin-flag" title="Admin">
        <i class="fa-solid fa-user-lock"></i>
      </div>

      <div class="logo">
        <img src="Quaker.png" class="header-logo" alt="Quaker logo">
      </div>
    </div>
  </div>

  <div class="container">
    <div class="controls">
      <div class="left">
        <div class="choose">Filter</div>
        <select id="filterSelect">
          <option value="all">All</option>
          <option value="common">Common</option>
          <option value="uncommon">Uncommon</option>
          <option value="rare">Rare</option>
          <option value="epic">Epic</option>
          <option value="legendary">Legendary</option>
        </select>
      </div>

      <div class="drop-actions">
        <button class="btn" id="viewDropsBtn"><i class="fa-solid fa-list"></i>&nbsp;Drops</button>
        <button class="btn drop" id="dropBtn"><i class="fa-solid fa-dice"></i>&nbsp;DROP</button>
      </div>
    </div>

    <div id="contentArea">
      <div class="grid-wrap">
        <div class="grid" id="itemGrid" aria-live="polite"></div>
      </div>
    </div>

    <div class="acquired-heading">Acquired Items</div>
    <div class="acquired-grid" id="acquiredGrid"></div>

    <div style="display:flex; gap:12px; margin-top:14px; flex-wrap:wrap;">
      <div style="flex:1; min-width:260px;">
        <div class="info-panel" id="infoPanel">
          Click a card to preview more info. Use DROP to open the spin modal and receive a weighted drop.
        </div>
      </div>

      <div style="width:320px;">
        <div class="info-panel">
          <div style="font-weight:900">Made By Route</div>
          <div style="color:var(--muted); margin-top:8px;" id="lastUpdated">Last updated: —</div>
        </div>
      </div>
    </div>
  </div>

  <div style="height:18px"></div>
  <div class="footer">
    <div>© Quaker City Roleplay</div>
    <div style="color:var(--muted)">Built with ❤️</div>
  </div>
</div>

<!-- Spin Wheel Modal -->
<div class="modal-overlay" id="spinModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">

    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:900; font-size:18px;">Spin Wheel</div>
      <div style="color:var(--muted); font-weight:800;">Click SPIN to start</div>
    </div>

    <div style="position:relative; margin-top:12px;">
      <div id="spinStrip" style="height:140px; display:flex; gap:12px; align-items:center; overflow:hidden; padding:10px;"></div>

      <!-- RED NEON SELECTOR -->
      <div class="neon-pointer"></div>
    </div>

    <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
      <button class="btn" id="closeSpin">Close</button>
      <button class="btn drop" id="spinStartBtn">SPIN</button>
    </div>
  </div>
</div>

<!-- YOU GOT POPUP UI -->
<div id="youGotPopup" class="you-got-popup">
  <div class="you-got-box">
    <div class="you-got-shockwave"></div>

    <div class="you-got-title">YOU GOT:</div>

    <div class="you-got-body">
      <img id="ygImg" class="you-got-img" src="" alt="">
      <div class="you-got-info">
        <div id="ygName" class="you-got-name">Weapon Name</div>
        <div id="ygRarity" class="you-got-rarity">RARITY</div>
      </div>
    </div>

    <button id="ygClose" class="you-got-close">Close</button>
  </div>
</div>

<!-- Weapon Details Popup Modal -->
<div id="weaponPopup" class="weapon-popup hidden" aria-hidden="true">
  <div class="weapon-popup-inner">

    <div class="weapon-popup-header">
      <h2 id="weaponPopupName">Weapon</h2>
      <div id="weaponPopupRarity" class="rarity-tag">COMMON</div>
    </div>

    <div class="weapon-popup-body">
      <img id="weaponPopupImage" class="weapon-popup-image" src="">
      <div class="weapon-stats-grid">
        <div class="stat-card">
          <div class="stat-title">Damage</div>
          <div id="statDamage" class="stat-value">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Fire Rate</div>
          <div id="statFire" class="stat-value">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Ammo</div>
          <div id="statAmmo" class="stat-value">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Magazine</div>
          <div id="statMagazine" class="stat-value">-</div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px; display:flex; justify-content:flex-end;">
      <button class="btn" onclick="closeWeaponPopup()">Close</button>
    </div>

  </div>
</div>

<!-- Stats Modal (fallback) -->
<div class="modal-overlay" id="statsModal" aria-hidden="true">
  <div class="modal">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div id="statsTitle" style="font-weight:900;"></div>
      <button class="btn" id="closeStats"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <div style="display:flex; gap:12px; margin-top:12px;">
      <div style="flex:0 0 220px; height:140px; border-radius:10px; overflow:hidden; background:rgba(0,0,0,.06); display:flex; align-items:center; justify-content:center;">
        <img id="statsImg" src="" style="max-width:100%; max-height:100%;">
      </div>
      <div style="flex:1;">
        <div id="statsRarity" style="color:var(--muted); font-weight:900;"></div>
        <div id="statsDetails" style="margin-top:12px; color:var(--muted);"></div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Panel -->
<div class="admin-panel" id="adminPanel" style="display:none;">
  <h3>Admin Panel</h3>
  <label>Discord Webhook</label>
  <input id="adminWebhook" type="text">
  <label>Server Uptime</label>
  <input id="adminUptime" type="text">
  <label>Price JSON URL</label>
  <input id="adminPrices" type="text">
  <button class="btn" id="saveAdminBtn">Save</button>
  <button class="btn" id="logoutAdminBtn">Logout</button>
</div>

<!-- Background Audio -->
<audio id="bgm" src="background_audio.mp3" loop preload="auto"></audio>
<script>
/* ============================================================
   BASIC CONFIG / SELECTORS
   ============================================================ */
const filterSelect   = document.getElementById("filterSelect");
const itemGrid       = document.getElementById("itemGrid");
const acquiredGrid   = document.getElementById("acquiredGrid");

const spinModal      = document.getElementById("spinModal");
const spinStartBtn   = document.getElementById("spinStartBtn");
const closeSpin      = document.getElementById("closeSpin");
const spinStrip      = document.getElementById("spinStrip");

const bgm            = document.getElementById("bgm");
const musicToggle    = document.getElementById("musicToggle");
const musicLabel     = document.getElementById("musicLabel");

const youGotPopup    = document.getElementById("youGotPopup");
const ygImg          = document.getElementById("ygImg");
const ygName         = document.getElementById("ygName");
const ygRarity       = document.getElementById("ygRarity");
const ygClose        = document.getElementById("ygClose");

/* ============================================================
   RARITY COLORS
   ============================================================ */
const RARITY_COLOR = {
  common:     "#a0a0a0",
  uncommon:   "#4cc94c",
  rare:       "#4c7cff",
  epic:       "#a020f0",
  legendary:  "#ffcc00"
};

/* ============================================================
   YOU GOT POPUP — SHOW FUNCTION
   ============================================================ */
function showYouGot(itemName, rarity, image) {
  ygImg.src = image;
  ygName.textContent = itemName;
  ygRarity.textContent = rarity.toUpperCase();
  ygRarity.style.color = RARITY_COLOR[rarity];

  youGotPopup.classList.add("active");

  // Reset animations
  const shock = document.querySelector(".you-got-shockwave");
  shock.style.animation = "none";
  shock.offsetHeight; // trigger reflow
  shock.style.animation = "shockwave 0.9s ease-out forwards";

  ygImg.style.animation = "none";
  ygImg.offsetHeight;
  ygImg.style.animation = "ygPop 0.40s ease-out forwards";
}

/* CLOSE YOU GOT */
ygClose.onclick = () => {
  youGotPopup.classList.remove("active");
};

/* ============================================================
   MUSIC TOGGLE
   ============================================================ */
musicToggle.onclick = () => {
  if (bgm.paused) {
    bgm.play();
    musicLabel.textContent = "Music: On";
  } else {
    bgm.pause();
    musicLabel.textContent = "Music: Off";
  }
};

/* ============================================================
   OPEN & CLOSE SPIN MODAL
   ============================================================ */
document.getElementById("dropBtn").onclick = () => {
  spinModal.style.display = "flex";
};
closeSpin.onclick = () => {
  spinModal.style.display = "none";
};

/* ============================================================
   WEIGHTED DROP TABLE (EXACTLY AS YOU ALREADY SET)
   ============================================================ */
const DROP_TABLE = {
  common: 25,
  uncommon: 25,
  rare: 30,
  epic: 35,
  legendary: 36
};

/* ============================================================
   WHEEL SPIN LOGIC (2.5 SEC)
   ============================================================ */
function chooseDrop() {
  const items = window.ALL_ITEMS; // your existing list
  let pool = [];

  Object.keys(items).forEach(name => {
    const rarity = items[name].rarity;
    const weight = DROP_TABLE[rarity] || 1;
    for (let i = 0; i < weight; i++) pool.push(name);
  });

  return pool[Math.floor(Math.random() * pool.length)];
}

/* ============================================================
   START SPIN BUTTON
   ============================================================ */
spinStartBtn.onclick = () => {
  spinStrip.innerHTML = "";

  const items = window.ALL_ITEMS;
  const entries = Object.keys(items);

  // Fill strip with images (looping)
  for (let i = 0; i < 40; i++) {
    const pick = entries[i % entries.length];
    const div = document.createElement("div");
    div.className = "strip-item";
    div.innerHTML = `<img src="${items[pick].image}" />`;
    spinStrip.appendChild(div);
  }

  // Animate strip (2.5 seconds total)
  spinStrip.style.transition = "transform 2.5s cubic-bezier(.17,.67,.83,.67)";
  spinStrip.style.transform = `translateX(-${Math.random() * 1200 + 2000}px)`;

  // Determine actual result
  const result = chooseDrop();
  const final = items[result];

  setTimeout(() => {
    spinModal.style.display = "none";

    // Add to acquired list
    addAcquired(result);

    // Show “YOU GOT”
    showYouGot(result, final.rarity, final.image);

  }, 2500);
};

/* ============================================================
   ADD ITEM TO ACQUIRED
   ============================================================ */
function addAcquired(name) {
  const card = document.createElement("div");
  card.className = "acq-card";
  card.innerHTML = `
    <img src="${ALL_ITEMS[name].image}">
    <div>${name}</div>
  `;
  acquiredGrid.appendChild(card);
}

/* ============================================================
   RENDER ITEMS TO GRID (Unchanged)
   ============================================================ */
function renderItems() {
  const filter = filterSelect.value;
  itemGrid.innerHTML = "";

  Object.keys(ALL_ITEMS).forEach(name => {
    const item = ALL_ITEMS[name];
    if (filter !== "all" && item.rarity !== filter) return;

    const card = document.createElement("div");
    card.className = "item-card";

    card.innerHTML = `
      <img src="${item.image}">
      <div class="item-name">${name}</div>
      <div class="item-rarity" style="color:${RARITY_COLOR[item.rarity]}">${item.rarity.toUpperCase()}</div>
    `;
    itemGrid.appendChild(card);
  });
}

filterSelect.onchange = renderItems;

/* Load initial */
renderItems();
</script>
