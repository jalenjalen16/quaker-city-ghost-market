<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quaker City's Contraband System</title>

<!-- Fonts + Icons -->
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- ===== CSS (All in one file) ===== -->
<style>
  /* -------- variables -------- */
  :root{
    --bg:#0a1428;              /* your dark navy */
    --panel:#0f1a2a;
    --accent:#dc143c;          /* Quaker red */
    --accent-2:#0047ab;        /* Quaker blue */
    --muted:#b0b8c0;
    --text:#ffffff;
    --glass: rgba(255,255,255,.03);
    --card-radius:14px;
    --shadow: 0 20px 60px rgba(0,0,0,.6);
    --glass-border: rgba(255,255,255,.04);
    --maxw:1200px;
  }

  /* -------- base -------- */
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:"Rajdhani", system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif; color:var(--text);}
  body{
    background:
      radial-gradient(1000px 500px at 10% -10%, rgba(220,20,60,.08), transparent 60%),
      radial-gradient(1000px 500px at 110% 10%, rgba(0,71,171,.07), transparent 60%),
      linear-gradient(180deg, var(--bg), #041125 120%);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px; display:flex; justify-content:center; min-height:100vh;
  }

  .wrap{ width:100%; max-width:var(--maxw); margin:0 auto; position:relative; z-index:5; }

  /* ===== Blurred Background Logo (centered large emblem) ===== */
  .background-logo {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 900px;
    height: 900px;
    transform: translate(-50%, -50%);
    background: url('Quaker.png') no-repeat center center/contain;
    opacity: 0.10;
    filter: blur(20px) saturate(.8);
    pointer-events: none;
    z-index:1;
    transition: opacity .8s ease, transform .8s ease;
  }
  @media (max-width:1100px){
    .background-logo { width:700px; height:700px; opacity:0.09; filter: blur(16px); }
  }
  @media (max-width:768px){
    .background-logo { width:480px; height:480px; opacity:0.07; filter: blur(12px); }
  }

  /* header */
  .header{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:18px; position:relative; z-index:6; }
  .header-left{ max-width:66%; }
  .title{ font-size:40px; margin:0; line-height:1; font-weight:900; color:var(--accent); text-shadow:0 8px 24px rgba(0,0,0,.6); }
  .subtitle{ margin-top:8px; color:var(--muted); font-weight:700; }

  .topnav{ display:flex; align-items:center; gap:8px; margin-top:12px; flex-wrap:wrap; }
  .topnav .cat{ color:var(--muted); text-decoration:none; font-weight:800; border-radius:10px; padding:8px 12px; border:1px solid rgba(255,255,255,.03); background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); cursor:pointer; }
  .topnav .cat.active{ background: linear-gradient(180deg, rgba(220,20,60,.12), rgba(0,71,171,.06)); border-color: rgba(220,20,60,.36); color:var(--text); box-shadow: 0 12px 40px rgba(220,20,60,.08); }

  .header-right{ display:flex; align-items:center; gap:12px; }
  .logo{ width:86px; height:86px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.06); display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0)); }
  .header-logo{ width:72px; height:72px; object-fit:contain; }

  /* container */
  .container{ background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border-radius:18px; padding:20px; border:1px solid var(--glass-border); box-shadow:var(--shadow); backdrop-filter: blur(8px) saturate(1.05); position:relative; z-index:6; }

  /* controls */
  .controls-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom:18px; }
  .controls-left{ display:flex; align-items:center; gap:12px; }
  label.choose{ color:var(--muted); font-weight:700; }
  select, input[type="text"]{ padding:10px 12px; border-radius:10px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.04); color:var(--text); font-weight:800; }

  /* buttons */
  .btn{ background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); padding:10px 14px; border-radius:10px; font-weight:900; cursor:pointer; }
  .btn.spin{ background: linear-gradient(180deg, rgba(220,20,60,.95), rgba(160,10,40,.85)); color:white; border:1px solid rgba(255,255,255,.14); box-shadow: 0 18px 40px rgba(220,20,60,.12); padding:12px 18px; font-size:16px; }

  /* reel */
  .reel-wrap{ margin-top:6px; border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,.03); background: linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,0)); overflow:hidden; position:relative; }
  .strip{ display:flex; gap:12px; align-items:center; padding:10px; transition: transform .12s linear; will-change: transform; }
  .slot{ min-width:120px; height:110px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,.06); background: linear-gradient(180deg, rgba(0,0,0,.20), rgba(255,255,255,0)); box-shadow: 0 6px 20px rgba(0,0,0,.5) inset; position:relative; cursor:pointer; }
  .slot img{ width:100%; height:100%; object-fit:cover; display:block; }
  .slot .label{ position:absolute; left:10px; bottom:8px; font-weight:800; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:92%; }

  .center-line{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:6px; height:86px; border-radius:6px; pointer-events:none; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); box-shadow: 0 0 18px rgba(255,212,0,.06); z-index:6; }

  /* acquired grid & cards */
  .acquired-heading{ margin:14px 0 10px; color: var(--accent); font-weight:900; font-size:18px; }
  .acquired-grid{ display:flex; gap:10px; flex-wrap:wrap; padding:6px 0; }
  .drop-card{ display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.04); background: linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,0)); min-width:220px; cursor:pointer; }
  .drop-card img{ width:56px; height:56px; object-fit:cover; border-radius:8px; }
  .drop-details .name{ font-weight:900; }
  .drop-details .rarity{ color:var(--muted); font-size:12px; margin-top:4px; font-weight:700; }

  /* info panels */
  .info-panel{ border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,.04); background: linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,0)); min-height:120px; }

  /* admin */
  .admin-flag{ font-weight:900; color:var(--muted); cursor:pointer; padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,.03); }
  .admin-panel{ position:fixed; right:18px; top:18px; width:360px; max-width:94%; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,.05); box-shadow: 0 18px 60px rgba(0,0,0,.6); z-index:999; display:none; }
  .admin-panel.open{ display:block; }

  /* modal */
  .stats-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.72); z-index:900; }
  .stats-overlay.open{ display:flex; }
  .stats-panel{ width:540px; max-width:94%; border-radius:12px; padding:18px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); }
  .stats-image{ width:100%; height:220px; object-fit:cover; border-radius:10px; margin-top:12px; }

  /* footer */
  .footer{ margin-top:20px; display:flex; justify-content:space-between; gap:12px; color:var(--muted); font-size:12px; }

  /* responsive */
  @media(max-width:980px){
    .header{ flex-direction:column; gap:12px; align-items:flex-start; }
    .header-right{ align-self:flex-end; }
  }
  @media(max-width:640px){
    .slot{ min-width:92px; height:82px; }
    .center-line{ height:72px; }
    .title{ font-size:28px; }
    .background-logo{ opacity:0.06; transform:translate(-50%,-50%) scale(.9); filter: blur(10px); }
  }

  /* small helpers */
  .sr-only{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
</style>
</head>
<body>
<!-- Background emblem (large blurred Quaker.png) -->
<div class="background-logo" aria-hidden="true"></div>
<div class="wrap">

  <!-- ===== HEADER ===== -->
  <div class="header">
    <div class="header-left">
      <h1 class="title">Quaker City</h1>
      <div class="subtitle">Contraband Spin System</div>

      <!-- Category Navigation -->
      <div class="topnav">
        <div class="cat active" data-cat="tier1">Tier 1 Weaponry</div>
        <div class="cat" data-cat="tier2">Tier 2 Weaponry</div>
        <div class="cat" data-cat="attachments">Attachments</div>
        <div class="cat" data-cat="drugs">Drugs</div>
        <div class="cat" data-cat="stats">Drops</div>
        <div class="cat" data-cat="turf">Turf</div>
        <div class="cat" data-cat="prices">Prices</div>
      </div>
    </div>

    <!-- Right side header -->
    <div class="header-right">
      <!-- Discord icon -->
      <a href="#" class="admin-flag" title="Admin Login">
        <i class="fa-solid fa-user-shield"></i>
      </a>

      <!-- Logo -->
      <div class="logo">
        <img src="Quaker.png" class="header-logo">
      </div>
    </div>
  </div>

  <!-- ===== MAIN CONTAINER ===== -->
  <div class="container">

    <!-- Controls Row -->
    <div class="controls-row">
      <div class="controls-left">
        <label class="choose">Choose Your Tier:</label>
        <select id="tier">
          <option value="tier1">Tier 1</option>
          <option value="tier2">Tier 2</option>
          <option value="attachments">Attachments</option>
          <option value="drugs">Drugs</option>
        </select>
      </div>

      <button class="btn spin" id="spinBtn">
        <i class="fa-solid fa-bolt"></i> Spin
      </button>
    </div>

    <!-- Reel / Spinner -->
    <div class="reel-wrap">
      <div class="strip" id="slotStrip"></div>
      <div class="center-line"></div>
    </div>

    <!-- Acquired Items -->
    <div class="acquired-heading">Acquired Items</div>
    <div class="acquired-grid" id="acquiredGrid"></div>

    <!-- Information Panels -->
    <div class="info-panel" id="infoPanel">
      <h3 style="margin:0 0 8px;">Information</h3>
      <p style="color:var(--muted)">
        Select a tier and press <b>Spin</b> to receive a random item.
      </p>
    </div>

  </div>

  <!-- Footer -->
  <div class="footer">
    <div>Made By Route</div>
    <div>Quaker City © 2025</div>
  </div>

</div>

<!-- ===== ADMIN PANEL ===== -->
<div class="admin-panel" id="adminPanel">
  <h2 style="margin-top:0;">Admin Panel</h2>
  <p style="color:var(--muted); font-size:14px;">Use this panel to configure advanced settings.</p>

  <label>Discord Webhook URL</label>
  <input type="text" id="webhookInput" placeholder="Enter webhook URL">

  <label>Server Uptime URL</label>
  <input type="text" id="uptimeInput" placeholder="Enter server URL">

  <label>Price JSON URL</label>
  <input type="text" id="priceInput" placeholder="Enter JSON URL">

  <button class="btn" id="saveAdmin">Save Settings</button>
</div>

<!-- ===== DROPS MODAL ===== -->
<div class="stats-overlay" id="statsOverlay">
  <div class="stats-panel">
    <h2 id="statsName"></h2>
    <div id="statsRarity" style="color:var(--muted); font-weight:700; font-size:14px;"></div>
    <img id="statsImage" class="stats-image" src="">
    <p id="statsDesc" style="color:var(--muted); margin-top:10px; font-size:14px;">
      More information will appear here for each drop.
    </p>
    <button class="btn" id="closeStats">Close</button>
  </div>
</div>
<script>
/* ============================
   Quaker City — Part 3 JS
   ============================ */

/* -------------------------
   Data (images, items, stats)
   ------------------------- */
const IMAGES = {
  '.38 Special': 'https://media.discordapp.net/attachments/1442278653823156367/1447814118647140403/25CE001F-484F-4FDF-BF4A-FC4774C95BCD.png?ex=6938fd78&is=6937abf8&hm=650ac7176eb502bd0a8f89a30f687df7740376b27875c134da94415c8ca8583e&=&format=webp&quality=lossless&width=1409&height=1409',
  'Ghost Glock 17': 'https://media.discordapp.net/attachments/1442278653823156367/1447814120631042150/832A4CE9-FD8F-4AC0-AD33-A17573FB6678.png?ex=6938fd79&is=6937abf9&hm=16aec57bccd0f7cd1175588d39da6c823d174cb0efc253dcd8a63dfd87a832ac&=&format=webp&quality=lossless&width=1409&height=1409',
  'Glock 20 Switch': 'https://media.discordapp.net/attachments/1442278653823156367/1447814332317696166/35DA8A73-BFE3-44FB-A322-4639CCF67A20.png?ex=6938fdab&is=6937ac2b&hm=6644d393db7d29e770b205701c80883aacbd346c8535bb9eb459bf6981216e49&=&format=webp&quality=lossless&width=938&height=1409',
  'FNX -45': 'https://media.discordapp.net/attachments/1442278653823156367/1447814330769870858/343542AE-DE5C-4B32-B0D6-7423317739F8.png?ex=6938fdab&is=6937ac2b&hm=55ec25ecf1870d70cd9e7eaeab3ed41f0fe330a0f5de81d6c00a85c91077cd85&=&format=webp&quality=lossless&width=938&height=1409',
  'Beretta M9': 'https://media.discordapp.net/attachments/1442278653823156367/1447814119729401876/3528B8D0-0ECC-40C1-B78E-9F4782A78B85.png?ex=6938fd79&is=6937abf9&hm=976919ed8fe548b39448559015fdada5b779a738b3eadb74a668264972b9f15f&=&format=webp&quality=lossless&width=1409&height=1409',
  'G23': 'https://media.discordapp.net/attachments/1442278653823156367/1447814176234934442/E29B517E-6328-4E2A-92FE-FD9A53E3E99A.png?ex=6938fd86&is=6937ac06&hm=c609222cccdcd0277828ebd4f5e882fde73c5abdca1fcaa96c436de37ccb02b4&=&format=webp&quality=lossless&width=1409&height=1409',
  'Hellcat': 'https://media.discordapp.net/attachments/1442278653823156367/1447814121537146910/42B203F6-78E4-4288-A0DF-77BCFBFC8491.png?ex=6938fd79&is=6937abf9&hm=899f048ac69f7bd97d234e06e1440467f8eee00cf76dce63bc92f379f7311e08&=&format=webp&quality=lossless&width=1409&height=1409',
  'Tec-9': 'https://media.discordapp.net/attachments/1442278653823156367/1447814333710078053/9A1825B7-AD94-48B5-AB47-83C94F02B819.png?ex=6938fdac&is=6937ac2c&hm=d790cd2e72173627bde30dc9fd83641c7108e6fa7ab49b70620255984ec5ec80&=&format=webp&quality=lossless&width=938&height=1409',
  'MAC-10': 'https://media.discordapp.net/attachments/1442278653823156367/1447814331390492773/E16A3CE7-8E47-47AF-A70C-28F47AD0B33D.png?ex=6938fdab&is=6937ac2b&hm=ac47f5f2451546001cd21a8bab4738559f77a58e1bdc87f79fc153bf1e275716&=&format=webp&quality=lossless&width=938&height=1409',
  'Tactical UZI': 'https://media.discordapp.net/attachments/1442278653823156367/1447814375309054043/1C5C28F1-9747-4DE1-88BE-28292005B41F.png?ex=6938fdb6&is=6937ac36&hm=fa9fdd2e4d6fff3f06c1e2f29d3a5ee8c821d07cdc4e11447af6ddee53c14d1d&=&format=webp&quality=lossless&width=938&height=1409',
  'G41': 'https://media.discordapp.net/attachments/1442278653823156367/1447814248481685504/45E3D0D9-2795-4872-BA5A-67D04AD1BDF1.png?ex=6938fd97&is=6937ac17&hm=0f0113c505728a7abb2b63968feef4259e323a13932fff1d67c2c6eb788a8855&=&format=webp&quality=lossless&width=938&height=1409',
  'MP9': 'https://media.discordapp.net/attachments/1442278653823156367/1447814119045464155/8D2F58DD-9AEC-4C7C-8D2D-47CCC9376227.png?ex=6938fd79&is=6937abf9&hm=aeebc48af0277cf9ae276786af3d2d03f53580019b21902fa971435199a67d15&=&format=webp&quality=lossless&width=1409&height=1409',
  'G19 MOS': 'https://media.discordapp.net/attachments/1442278653823156367/1447814247525646497/F3AE3066-EFE9-41CB-B578-5EC03C6A2D7A.png?ex=6938fd97&is=6937ac17&hm=b2ca9fe16355feb412525d74e3258ee78e70b5d3319f43e80658c6ab763defe7&=&format=webp&quality=lossless&width=938&height=1409',
  'P90': 'https://media.discordapp.net/attachments/1442278653823156367/1447814500354097243/EEF50C44-F770-443A-8F78-201EA7DD9944.png?ex=6938fdd3&is=6937ac53&hm=35ee06a59543f1a5337fc7510b7d0e46c057ae937cfa4b7850a3ecae4576ed62&=&format=webp&quality=lossless&width=938&height=1409',
  'HELLPUP DRACO': 'https://cdn.discordapp.com/attachments/1442278653823156367/1447814499363983380/F0D2E6C6-183F-4CC9-904C-9F87B960B06C.png?ex=6938fdd3&is=6937ac53&hm=c40b2fff419247c3224f930075728d431f1626c69d13192a3dab2e7b41b09801&',
  'AK-47': 'https://media.discordapp.net/attachments/1442278653823156367/1447814499695460513/DC2C73DE-7FDD-46D4-898E-E7203EF9C070.png?ex=6938fdd3&is=6937ac53&hm=32b6543af236003ee2dd96d10cd6979af10e8672a6743d8cbb9da68ae8dd5125&=&format=webp&quality=lossless&width=938&height=1409',
  'Black ARP': 'https://media.discordapp.net/attachments/1442278653823156367/1447814373601972285/C4FE017E-B958-42C2-9C74-6268A11CD25A.png?ex=6938fdb5&is=6937ac35&hm=ad76540e38b64398d91474fbb80cd023862a4a3e42c420b93c19f71fa499830a&=&format=webp&quality=lossless&width=938&height=1409',
  'KEL-TEC PLR': 'https://media.discordapp.net/attachments/1442278653823156367/1447814331868774410/37DC7D8A-3EA6-4F01-9436-D5E736E13C4A.png?ex=6938fdab&is=6937ac2b&hm=c233af0b74069b5196ee10448b44ec96c8a10322285015ab58daf74bc9603bcd&=&format=webp&quality=lossless&width=938&height=1409',
  'Draco': 'https://media.discordapp.net/attachments/1442278653823156367/1447814332862824469/E7E6F61C-2D83-425C-B230-AF4EEF446C3A.png?ex=6938fdac&is=6937ac2c&hm=0fa109d9c32d00a2e01443055de8dd0e16d035963b9fbe87f6f434b3a09b951c&=&format=webp&quality=lossless&width=938&height=1409'
};
const FALLBACK_IMG = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="240"%3E%3Crect fill="%23333" width="400" height="240"/%3E%3Ctext x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E';

const ALL_ITEMS = [
  ['.38 Special','common','tier1'],
  ['Ghost Glock 17','common','tier1'],
  ['Glock 20 Switch','epic','tier1'],
  ['FNX -45','epic','tier1'],
  ['Beretta M9','uncommon','tier1'],
  ['G23','uncommon','tier1'],
  ['Tec-9','epic','tier1'],
  ['MAC-10','uncommon','tier1'],
  ['Micro UZI','rare','tier1'],
  ['G41','rare','tier1'],
  ['MP9','common','tier1'],
  ['G19 MOS','rare','tier1'],
  ['G19 MOS','rare','tier1'],
  ['HELLPUP DRACO','legendary','tier2'],
  ['AK-47','legendary','tier2'],
  ['Black ARP','epic','tier2'],
  ['KEL-TEC PLR','epic','tier2'],
  ['Draco','epic','tier2']
];

const DRUGS = [
  ['RP 10','common','rp_10'],
  ['MBox 10','common','mbox_10'],
  ['V 230','common','v_230'],
  ['K56','common','k_56'],
  ['Line of Green','uncommon','line_green'],
  ['K8','uncommon','k8_greens'],
  ['V 48','uncommon','v_48'],
  ['Green Pint','uncommon','pint_green'],
  ['RP 20','rare','rp_20'],
  ['Line of Wockhardt','rare','line_wock'],
  ['Line of Pai','rare','line_pai'],
  ['MBox 30','epic','mbox_30'],
  ['RP 30','epic','rp_30'],
  ['Superman Pill','epic','superman'],
  ['Quagen Pint','epic','quagen_pint'],
  ['Wockhardt Pint','epic','wock_pint']
];

const ATTACHMENTS = [
  ['Flashlight','uncommon','attach_light'],
  ['Extended Magazine','rare','mag_ext'],
  ['Drum Magazine','epic','drum_mag'],
  ['Auto Sear','legendary','autosear'],
  ['Switch','legendary','switch']
];

const WEAPON_STATS = {
  '.38 Special': { damage:28, fire:750, ammo:'9mm', magStd:15, magExt:33 },
  'Glock 19': { damage:28, fire:750, ammo:'9mm', magStd:15, magExt:33 },
  'Glock 20': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 },
  'Beretta M9': { damage:28, fire:750, ammo:'9mm', magStd:15, magExt:30 },
  'G23': { damage:30, fire:750, ammo:'9mm', magStd:16, magExt:32 },
  'FNX -45': { damage:32, fire:400, ammo:'.45 ACP', magStd:8, magExt:16 },
  'Tec-9': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 },
  'MAC-10': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50  },
  'Micro UZI': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 },
  'G41': { damage:23, fire:1100, ammo:'.32 ACP', magStd:20, magExt:40 },
  'MP9': { damage:28, fire:750, ammo:'9mm', magStd:15, magExt:33 },
  'G19 MOS': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 },
  'P90': { damage:40, fire:750, ammo:'5.56x45', magStd:30, magExt:60 },
  'HELLPUP DRACO': { damage:40, fire:750, ammo:'5.56x45', magStd:30, magExt:60 },
  'AK-47': { damage:40, fire:750, ammo:'5.56x45', magStd:30, magExt:60 },
  'Black ARP': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 },
  'KEL-TEC PLR': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 },
  'Draco': { damage:30, fire:600, ammo:'.45 ACP', magStd:25, magExt:50 }
};

/* -------------------------
   Default weights (user config)
   ------------------------- */
const DEFAULT_WEIGHTS = {
  tier1: { common:35, uncommon:40, rare:25, epic:10 },
  tier2: { rare:50, epic:40, legendary:10 },
  attachments: { uncommon:50, rare:30, epic:15, legendary:5 },
  drugs: { common:35, uncommon:25, rare:25, epic:15 }
};

/* -------------------------
   DOM refs (match Part 2)
   ------------------------- */
const slotStrip = document.getElementById('slotStrip');
const tierSelect = document.getElementById('tier');
const spinBtn = document.getElementById('spinBtn');
const acquiredGrid = document.getElementById('acquiredGrid');

const adminFlag = document.querySelector('.admin-flag');
const adminPanel = document.getElementById('adminPanel');
const webhookInput = document.getElementById('webhookInput');
const uptimeInput = document.getElementById('uptimeInput');
const priceInput = document.getElementById('priceInput');
const saveAdminBtn = document.getElementById('saveAdmin');

const statsOverlay = document.getElementById('statsOverlay');
const statsName = document.getElementById('statsName');
const statsRarity = document.getElementById('statsRarity');
const statsImage = document.getElementById('statsImage');
const statsDesc = document.getElementById('statsDesc');
const closeStatsBtn = document.getElementById('closeStats');

let drops = []; // recent acquired items
let spinning = false;

/* -------------------------
   Local storage helpers
   ------------------------- */
function loadConfig(){
  const cfg = JSON.parse(localStorage.getItem('qc_config') || '{}');
  return {
    webhook: cfg.webhook || '',
    uptimeUrl: cfg.uptimeUrl || '',
    priceUrl: cfg.priceUrl || '',
    weights: cfg.weights || JSON.parse(JSON.stringify(DEFAULT_WEIGHTS))
  };
}
function saveConfig(cfg){
  localStorage.setItem('qc_config', JSON.stringify(cfg));
}

/* -------------------------
   Admin auth (simple client-side)
   ------------------------- */
const ADMIN_PASS = 'Qacti'; // from user
function isAdmin(){
  return sessionStorage.getItem('qc_admin') === '1';
}
function setAdmin(flag){
  if(flag) sessionStorage.setItem('qc_admin','1'); else sessionStorage.removeItem('qc_admin');
  adminPanel.style.display = flag ? 'block' : 'none';
}

/* admin flag click => prompt */
adminFlag.addEventListener('click', ()=>{
  if(isAdmin()){
    // already admin => toggle panel
    adminPanel.style.display = adminPanel.style.display === 'block' ? 'none' : 'block';
    return;
  }
  const pw = prompt('Enter admin password:');
  if(pw === ADMIN_PASS){
    setAdmin(true);
    loadAdminUI();
    alert('Admin access granted.');
  } else {
    alert('Wrong password.');
  }
});

/* logout when save/close? we'll keep simple */

/* -------------------------
   Music + SFX setup
   ------------------------- */
const audioCtx = (window.AudioContext || window.webkitAudioContext) ? new (window.AudioContext || window.webkitAudioContext)() : null;
let bgmAudio = null;
function setupBGM(){
  // create audio element pointing to OceanEyes.mp3 (user must upload file)
  bgmAudio = document.createElement('audio');
  bgmAudio.id = 'bgm';
  bgmAudio.src = 'OceanEyes.mp3';
  bgmAudio.loop = true;
  bgmAudio.preload = 'auto';
  bgmAudio.crossOrigin = 'anonymous';
  document.body.appendChild(bgmAudio);

  // resume audio context on first user gesture and play bgm
  function startOnGesture(){
    if(audioCtx && audioCtx.state === 'suspended') {
      audioCtx.resume().catch(()=>{});
    }
    bgmAudio.play().catch(()=>{/* playback may be blocked until gesture; it's fine */});
    window.removeEventListener('click', startOnGesture);
    window.removeEventListener('touchstart', startOnGesture);
  }
  window.addEventListener('click', startOnGesture);
  window.addEventListener('touchstart', startOnGesture);
}

/* tiny SFX generator using oscillator */
function playTone(freq, len=0.08, type='sine', gain=0.06){
  if(!audioCtx) return;
  try{
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = 0;
    o.connect(g); g.connect(audioCtx.destination);
    const now = audioCtx.currentTime;
    g.gain.linearRampToValueAtTime(gain, now + 0.01);
    o.start(now);
    g.gain.exponentialRampToValueAtTime(0.0001, now + len);
    o.stop(now + len + 0.02);
  } catch(e){}
}
function playSFX(name){
  if(!audioCtx) return;
  if(name === 'click') playTone(880,0.06,'square',0.05);
  if(name === 'spin') { playTone(240,0.12,'sawtooth',0.12); }
  if(name === 'win') {
    playTone(880,0.08,'sine',0.12);
    setTimeout(()=> playTone(1320,0.12,'sine',0.11), 120);
    setTimeout(()=> playTone(1760,0.16,'sine',0.09), 260);
  }
}

/* -------------------------
   Utility helpers
   ------------------------- */
function randItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

/* -------------------------
   Weights & picking
   ------------------------- */
function loadWeights(){
  const cfg = loadConfig();
  return cfg.weights;
}
function saveWeights(w){
  const cfg = loadConfig();
  cfg.weights = w;
  saveConfig(cfg);
}

/* pick rarity based on weights object */
function pickRarity(weightsObj){
  const entries = Object.entries(weightsObj).filter(([k,v])=> Number(v) > 0 );
  const total = entries.reduce((s,[_k,v])=> s + Number(v), 0);
  const r = Math.random() * total;
  let acc = 0;
  for(const [k,v] of entries){
    acc += Number(v);
    if(r <= acc) return k;
  }
  return entries[entries.length-1][0];
}

/* pick an item for a given tier using weights */
function pickItemForTier(tierKey){
  const weights = loadWeights();
  if(tierKey === 'tier1'){
    const rarity = pickRarity(weights.tier1);
    const pool = ALL_ITEMS.filter(i => i[2] === 'tier1' && i[1] === rarity);
    if(pool.length) return randItem(pool)[0];
    return randItem(ALL_ITEMS.filter(i => i[2] === 'tier1'))[0];
  }
  if(tierKey === 'tier2'){
    const rarity = pickRarity(weights.tier2);
    const pool = ALL_ITEMS.filter(i => i[2] === 'tier2' && i[1] === rarity);
    if(pool.length) return randItem(pool)[0];
    return randItem(ALL_ITEMS.filter(i => i[2] === 'tier2'))[0];
  }
  if(tierKey === 'attachments'){
    const rarity = pickRarity(weights.attachments);
    const pool = ATTACHMENTS.filter(a => a[1] === rarity);
    if(pool.length) return randItem(pool)[0];
    return randItem(ATTACHMENTS)[0];
  }
  if(tierKey === 'drugs'){
    const rarity = pickRarity(weights.drugs);
    const pool = DRUGS.filter(d => d[1] === rarity);
    if(pool.length) return randItem(pool)[0];
    return randItem(DRUGS)[0];
  }
  // default fallback
  return randItem(ALL_ITEMS)[0];
}

/* -------------------------
   Render the strip (visual pool)
   ------------------------- */
function renderStrip(tierKey){
  slotStrip.innerHTML = '';
  let pool = [];
  if(tierKey === 'attachments') pool = ATTACHMENTS.map(a=>[a[0],a[1]]);
  else if(tierKey === 'drugs') pool = DRUGS.map(d=>[d[0],d[1]]);
  else pool = ALL_ITEMS.filter(i=> i[2] === tierKey).map(i=>[i[0],i[1]]);

  if(!pool || pool.length === 0) pool = ALL_ITEMS.map(i=>[i[0],i[1]]);
  const count = Math.max(30, Math.min(80, pool.length * 6));
  for(let i=0;i<count;i++){
    const t = randItem(pool);
    const el = document.createElement('div');
    el.className = 'slot';
    const src = IMAGES[t[0]] || FALLBACK_IMG;
    el.innerHTML = `<img src="${src}" alt="${t[0]}"><div class="label">${t[0]}</div>`;
    el.dataset.name = t[0];
    el.dataset.rarity = t[1] || 'common';
    el.addEventListener('click', ()=> openInfoModal(el.dataset.name, el.dataset.rarity, src));
    slotStrip.appendChild(el);
  }
}

/* -------------------------
   Find winner (tile covering center)
   ------------------------- */
function tileAtCenter(){
  const rect = slotStrip.getBoundingClientRect();
  // center relative to viewport
  const centerX = window.innerWidth / 2;
  const children = Array.from(slotStrip.children).filter(c => c.classList && c.classList.contains('slot'));
  for(const c of children){
    const r = c.getBoundingClientRect();
    if(r.left <= centerX && r.right >= centerX) return c;
  }
  // fallback: pick a random slot
  return children[Math.floor(Math.random() * children.length)];
}

/* -------------------------
   Spin routine (visual)
   ------------------------- */
async function spinRoutine(){
  if(spinning) return;
  spinning = true;
  playSFX('spin');

  const tierKey = tierSelect.value; // 'tier1' etc
  // pre-render a fresh strip with pool for chosen tier
  renderStrip(tierKey);
  await tick(30);

  // shift elements by re-appending first to end with easing delays
  const shifts = 48 + Math.floor(Math.random() * 44);
  for(let i=0;i<shifts;i++){
    if(slotStrip.firstElementChild) slotStrip.appendChild(slotStrip.firstElementChild);
    const progress = i / shifts;
    const delay = 18 + Math.pow(progress, 2) * 520;
    await tick(delay);
  }

  // determine winner element
  const winner = tileAtCenter();
  if(winner){
    const name = winner.dataset.name || winner.querySelector('img')?.alt || 'Unknown';
    const rarity = winner.dataset.rarity || 'common';
    // if we want the drop weighting to reflect true chance, pick a new item using pickItemForTier
    // We'll replace the visible winner with the weighted pick to match configured weights
    const weightedPick = pickItemForTier(tierKey);
    // find an index in the visible slots to replace or just treat weightedPick as the result
    addAcquired(weightedPick, rarityForName(weightedPick));
    openInfoModal(weightedPick, rarityForName(weightedPick), IMAGES[weightedPick] || FALLBACK_IMG);
    // highlight winner visually
    winner.style.boxShadow = '0 18px 60px rgba(255,200,0,.14)';
    playSFX('win');
    // send webhook
    sendWebhook({ action:'spin', tier: tierKey, result: weightedPick, rarity: rarityForName(weightedPick), ts: new Date().toISOString() });
    setTimeout(()=> { winner.style.boxShadow = ''; }, 1600);
  }

  setTimeout(()=> { spinning = false; }, 400);
}

/* small sleep helper */
function tick(ms){ return new Promise(res => setTimeout(res, ms)); }

/* -------------------------
   Utility: determine rarity for a name by searching arrays
   ------------------------- */
function rarityForName(name){
  const f1 = ALL_ITEMS.find(i=> i[0] === name);
  if(f1) return f1[1];
  const f2 = ATTACHMENTS.find(a=> a[0] === name);
  if(f2) return f2[1];
  const f3 = DRUGS.find(d=> d[0] === name);
  if(f3) return f3[1];
  return 'common';
}

/* -------------------------
   Add acquired card to grid
   ------------------------- */
function addAcquired(name, rarity){
  const card = document.createElement('div');
  card.className = 'drop-card';
  const src = IMAGES[name] || FALLBACK_IMG;
  card.innerHTML = `<img src="${src}" alt="${name}"><div class="drop-details"><div class="name">${name}</div><div class="rarity">${(rarity||'common').toUpperCase()}</div></div>`;
  card.addEventListener('click', ()=> openInfoModal(name, rarity, src));
  acquiredGrid.prepend(card);
  drops.unshift({ name, rarity, src, ts: Date.now() });
  if(drops.length > 120) { drops.pop(); while(acquiredGrid.children.length > 120) acquiredGrid.removeChild(acquiredGrid.lastChild); }
}

/* -------------------------
   Modal open/close
   ------------------------- */
function openInfoModal(name, rarity, src){
  statsName.textContent = name;
  statsRarity.textContent = (rarity||'common').toUpperCase();
  statsImage.src = src || FALLBACK_IMG;
  const s = WEAPON_STATS[name] || {};
  statsDesc.innerHTML = `
    <div style="font-weight:900">${name}</div>
    <div style="color:var(--muted)">Damage: ${s.damage||'-'} • Fire: ${s.fire? s.fire+' RPM' : '-'} • Ammo: ${s.ammo||'-'}</div>
  `;
  statsOverlay.classList.add('open');
}
closeStatsBtn.addEventListener('click', ()=> { statsOverlay.classList.remove('open'); });

statsOverlay.addEventListener('click', (e)=> {
  if(e.target === statsOverlay) statsOverlay.classList.remove('open');
});

/* -------------------------
   Webhook logger (client-side)
   ------------------------- */
async function sendWebhook(payload){
  const cfg = loadConfig();
  const webhook = cfg.webhook || '';
  if(!webhook) return;
  try{
    await fetch(webhook, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ content: `Quaker City | Spin: ${payload.result || ''} (${payload.rarity || ''}) — tier:${payload.tier} — ${payload.ts}` })
    });
  } catch(e){
    console.warn('webhook failed', e);
  }
}

/* -------------------------
   Uptime poller & price fetcher
   ------------------------- */
let uptimeTimer = null;
async function startUptime(url){
  if(!url) return;
  const el = document.getElementById('infoPanel');
  async function check(){
    try{
      const r = await fetch(url, { cache:'no-store', mode:'cors' });
      if(r.ok) {
        el.querySelector('.info-panel')?.classList.remove('offline');
        document.getElementById('lastupdated').textContent = 'Server: ONLINE';
      } else {
        document.getElementById('lastupdated').textContent = 'Server: OFFLINE';
      }
    } catch(e){
      document.getElementById('lastupdated').textContent = 'Server: OFFLINE';
    }
  }
  check();
  if(uptimeTimer) clearInterval(uptimeTimer);
  uptimeTimer = setInterval(check, 15000);
}

async function fetchPriceSummary(url){
  if(!url) return;
  try{
    const r = await fetch(url, { cache:'no-store' });
    if(!r.ok) throw new Error('bad fetch');
    const data = await r.json();
    // simple summary
    const keys = Object.keys(data).slice(0,3);
    document.getElementById('lastupdated').textContent = 'Prices: ' + keys.map(k => `${k}:${data[k]}`).join(' • ');
  } catch(e){
    console.warn('price fetch failed', e);
  }
}

/* -------------------------
   Admin: load & save UI
   ------------------------- */
function loadAdminUI(){
  const cfg = loadConfig();
  webhookInput.value = cfg.webhook || '';
  uptimeInput.value = cfg.uptimeUrl || '';
  priceInput.value = cfg.priceUrl || '';

  // populate numeric weight inputs inside admin panel if present (Part2 admin fields are simplified)
  // We'll also expose a quick way to reset weights via console if needed
}
saveAdminBtn.addEventListener('click', ()=> {
  if(!isAdmin()){ alert('Please login as admin first.'); return; }
  const cfg = loadConfig();
  cfg.webhook = webhookInput.value.trim();
  cfg.uptimeUrl = uptimeInput.value.trim();
  cfg.priceUrl = priceInput.value.trim();
  // weights handling: advanced UI not present in this Part2 version — could be added
  saveConfig(cfg);
  alert('Settings saved. If uptime or price URL were provided, they will be polled shortly.');
  if(cfg.uptimeUrl) startUptime(cfg.uptimeUrl);
  if(cfg.priceUrl) fetchPriceSummary(cfg.priceUrl);
});

/* -------------------------
   Small helpers to attach behavior to topnav categories
   ------------------------- */
document.querySelectorAll('.topnav .cat').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.topnav .cat').forEach(x => x.classList.remove('active'));
    el.classList.add('active');
    const k = el.dataset.cat;
    // map dataset names from Part2 to tier keys expected by logic
    const map = { tier1:'tier1', tier2:'tier2', attachments:'attachments', drugs:'drugs', stats:'tier1', turf:'tier2', prices:'tier1' };
    const key = map[k] || 'tier1';
    tierSelect.value = key;
    renderStrip(key);
  });
});

/* -------------------------
   Wire up spin & controls
   ------------------------- */
spinBtn.addEventListener('click', ()=> {
  playSFX('click');
  spinRoutine();
});
tierSelect.addEventListener('change', ()=> {
  renderStrip(tierSelect.value);
});

/* -------------------------
   Initialization
   ------------------------- */
function init(){
  // setup music + audio
  setupBGM();

  // render default strip
  renderStrip('tier1');

  // load config and start optional services
  const cfg = loadConfig();
  if(cfg.uptimeUrl) startUptime(cfg.uptimeUrl);
  if(cfg.priceUrl) fetchPriceSummary(cfg.priceUrl);

  // admin panel hidden until login
  adminPanel.style.display = isAdmin() ? 'block' : 'none';
  loadAdminUI();

  // set a friendly last-updated note
  document.getElementById('lastupdated').textContent = 'Loaded: ' + new Date().toLocaleString();
}

/* expose a console helper to set admin via console if you need it:
   sessionStorage.setItem('qc_admin','1'); location.reload();
*/
init();

/* -------------------------
   Developer console hints
   ------------------------- */
console.log('Quaker City — single-file JS loaded.');
console.log('Admin password (client-side):', ADMIN_PASS);
console.log('To enable webhook, set it in Admin Panel after logging in. Upload OceanEyes.mp3 and Quaker.png to repo root.');
</script>
